<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ëª¸ì¼ê¸° v2.1</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:#1a1a1a;color:#fff}
.app{max-width:480px;margin:0 auto;min-height:100vh}
.page{display:none}
.page.active{display:block}
.mint-btn{background:#00d9c0;color:#000;font-weight:700;padding:12px 24px;border-radius:12px;border:none;cursor:pointer}
.dark-card{background:#2a2a2a;border-radius:16px;padding:20px;margin:10px 0}
.nav{position:fixed;bottom:0;left:0;right:0;background:#1f1f1f;border-top:1px solid#333;max-width:480px;margin:0 auto}
.nav button{flex:1;padding:12px;background:none;border:none;color:#888;cursor:pointer}
.nav button.active{color:#00d9c0}
input,select,textarea{background:#2a2a2a;border:1px solid#3a3a3a;color:#fff;padding:12px;border-radius:8px;width:100%;margin:8px 0}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;background:#2a2a2a;font-size:14px}
.cal-day.recorded{background:#00d9c0;color:#000;font-weight:bold}
.cal-day.today{border:2px solid#00d9c0}
.symptom-tag{display:inline-block;background:#3a3a3a;padding:8px 12px;border-radius:20px;margin:4px;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.symptom-tag.selected{background:#00d9c0;color:#000;border-color:#00d9c0;font-weight:bold}
.filter-btn{background:#3a3a3a;padding:8px 16px;border-radius:8px;border:none;color:#fff;cursor:pointer;margin:4px}
.filter-btn.active{background:#00d9c0;color:#000;font-weight:bold}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ë°ì´í„° êµ¬ì¡°
let DB={
  records:[],
  profile:{name:'ì‚¬ìš©ì',age:30,gender:'',height:170,weight:65},
  posts:[],
  dateFilter:'1month'
};

// í™•ì¥ëœ RULE ë°ì´í„°ë² ì´ìŠ¤
const RULES=[
  {c:"ë³€ë¹„",s:["í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤","í”„ë¦¬ë°”ì´ì˜¤í‹±ìŠ¤","ë§ˆê·¸ë„¤ìŠ˜"],f:["ê·€ë¦¬","ìš”ê±°íŠ¸","ë¸”ë£¨ë² ë¦¬","ì‚¬ê³¼"],h:["ì‹í›„ 20ë¶„ ì‚°ì±…","ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨"],e:"ìŠ¤íŠ¸ë ˆì¹­ 15ë¶„"},
  {c:"í”¼ë¡œ",s:["ë¹„íƒ€ë¯¼Bë³µí•©ì²´","ì½”ì—”ìì„Q10","ì² ë¶„","ì¸ì‚¼"],f:["ì‹œê¸ˆì¹˜","ê²¬ê³¼ë¥˜","ì—°ì–´","ê·€ë¦¬"],h:["ì¶©ë¶„í•œ ìˆ˜ë©´","ê·œì¹™ì ì¸ ì‹ì‚¬"],e:"ê±·ê¸° 20ë¶„"},
  {c:"ë¶ˆë©´ì¦",s:["ë©œë¼í† ë‹Œ","ë§ˆê·¸ë„¤ìŠ˜","í…Œì•„ë‹Œ","ë°œë ˆë¦¬ì•ˆ"],f:["ë°”ë‚˜ë‚˜","ìš°ìœ ","í˜¸ë‘","ì²´ë¦¬"],h:["ì·¨ì¹¨ 1ì‹œê°„ ì „ ìŠ¤ë§ˆíŠ¸í° ê¸ˆì§€","ê·œì¹™ì ì¸ ì·¨ì¹¨ ì‹œê°„"],e:"ìš”ê°€ 30ë¶„"},
  {c:"ë‘í†µ",s:["ë§ˆê·¸ë„¤ìŠ˜","ë¹„íƒ€ë¯¼B2","ì½”ì—”ìì„Q10"],f:["ë¬¼","ì‹œê¸ˆì¹˜","ì•„ëª¬ë“œ"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ê·œì¹™ì ì¸ ì‹ì‚¬","ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬"],e:"ëª©/ì–´ê¹¨ ìŠ¤íŠ¸ë ˆì¹­ 10ë¶„"},
  {c:"ìŠ¤íŠ¸ë ˆìŠ¤",s:["ë§ˆê·¸ë„¤ìŠ˜","í…Œì•„ë‹Œ","ë¡œë””ì˜¬ë¼"],f:["ë°”ë‚˜ë‚˜","ì•„ëª¬ë“œ","ë‹¤í¬ì´ˆì½œë¦¿"],h:["ëª…ìƒ 10ë¶„","ì¶©ë¶„í•œ ìˆ˜ë©´","í˜¸í¡ ìš´ë™"],e:"ìš”ê°€ 20ë¶„"},
  {c:"ì†Œí™”ë¶ˆëŸ‰",s:["ì†Œí™”íš¨ì†Œ","í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤","ìƒê°•"],f:["ì–‘ë°°ì¶”","ìƒê°•ì°¨","ë°”ë‚˜ë‚˜"],h:["ì²œì²œíˆ ë¨¹ê¸°","ì‹ì‚¬ í›„ ëˆ•ì§€ ì•Šê¸°"],e:"ì‹í›„ ê°€ë²¼ìš´ ì‚°ì±… 10ë¶„"},
  {c:"ê·¼ìœ¡í†µ",s:["ë§ˆê·¸ë„¤ìŠ˜","BCAA","ì˜¤ë©”ê°€3"],f:["ê³„ë€","ë‹­ê°€ìŠ´ì‚´","ë°”ë‚˜ë‚˜"],h:["ì¶©ë¶„í•œ ìŠ¤íŠ¸ë ˆì¹­","íšŒë³µ ì‹œê°„"],e:"ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­"},
  {c:"ê´€ì ˆí†µ",s:["ê¸€ë£¨ì½”ì‚¬ë¯¼","ì½˜ë“œë¡œì´ì¹œ","ì˜¤ë©”ê°€3"],f:["ì—°ì–´","ì²´ë¦¬","ìƒê°•"],h:["ì²´ì¤‘ ê´€ë¦¬","ê´€ì ˆ ë³´í˜¸"],e:"ìˆ˜ì˜"},
  {c:"í”¼ë¶€ê±´ì¡°",s:["ì˜¤ë©”ê°€3","ë¹„íƒ€ë¯¼E","íˆì•Œë£¨ë¡ ì‚°"],f:["ì•„ë³´ì¹´ë„","ê²¬ê³¼ë¥˜","ì—°ì–´"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ë³´ìŠµì œ ì‚¬ìš©"],e:"ê±·ê¸° 20ë¶„"},
  {c:"ì§‘ì¤‘ë ¥ì €í•˜",s:["ì˜¤ë©”ê°€3","ì€í–‰ìì¶”ì¶œë¬¼","ë¹„íƒ€ë¯¼B"],f:["ë¸”ë£¨ë² ë¦¬","í˜¸ë‘","ì•„ë³´ì¹´ë„"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ê·œì¹™ì ì¸ íœ´ì‹"],e:"ê±·ê¸° 20ë¶„"}
];

const SYMPTOMS=["ë³€ë¹„","í”¼ë¡œ","ë¶ˆë©´ì¦","ë‘í†µ","ìŠ¤íŠ¸ë ˆìŠ¤","ì†Œí™”ë¶ˆëŸ‰","ê·¼ìœ¡í†µ","ê´€ì ˆí†µ","í”¼ë¶€ê±´ì¡°","ì§‘ì¤‘ë ¥ì €í•˜"];

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
function load(){const d=localStorage.getItem('mybodydata');if(d)DB=JSON.parse(d)}
function save(){localStorage.setItem('mybodydata',JSON.stringify(DB))}

load();

// ë‚ ì§œ í•„í„° ê³„ì‚°
function getFilteredDates(){
  const today=new Date();
  const start=new Date();
  
  if(DB.dateFilter==='1month'){
    start.setMonth(start.getMonth()-1);
  }else if(DB.dateFilter==='3month'){
    start.setMonth(start.getMonth()-3);
  }else if(DB.dateFilter==='lastmonth'){
    start.setMonth(start.getMonth()-1);
    start.setDate(1);
    today.setDate(0);
  }
  
  return DB.records.filter(r=>{
    const d=new Date(r.date);
    return d>=start&&d<=today;
  });
}

// í˜ì´ì§€ ë Œë”ë§
function render(page){
  const app=document.getElementById('app');
  
  if(page==='home'){
    const total=DB.records.length;
    const lastRec=DB.records[DB.records.length-1];
    const lastSymptoms=lastRec&&lastRec.symptoms?lastRec.symptoms:[];
    
    // ì¦ìƒ ê¸°ë°˜ ì¶”ì²œ ìƒì„±
    let recommendations={supplements:[],foods:[],habits:[],exercise:''};
    if(lastSymptoms.length>0){
      lastSymptoms.forEach(sym=>{
        const rule=RULES.find(r=>r.c===sym);
        if(rule){
          recommendations.supplements.push(...rule.s);
          recommendations.foods.push(...rule.f);
          recommendations.habits.push(...rule.h);
          if(!recommendations.exercise)recommendations.exercise=rule.e;
        }
      });
      // ì¤‘ë³µ ì œê±°
      recommendations.supplements=[...new Set(recommendations.supplements)];
      recommendations.foods=[...new Set(recommendations.foods)];
      recommendations.habits=[...new Set(recommendations.habits)];
    }
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <h1 class="text-3xl font-bold mb-2">ë‚´ëª¸ì¼ê¸°</h1>
        <p class="text-gray-400 mb-6">ì•ˆë…•í•˜ì„¸ìš”, ${DB.profile.name}ë‹˜! ğŸ‘‹</p>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="dark-card">
            <p class="text-sm text-gray-400">ì´ ê¸°ë¡</p>
            <p class="text-3xl font-bold text-green-400">${total}ê°œ</p>
          </div>
          <div class="dark-card">
            <p class="text-sm text-gray-400">ì—°ì† ê¸°ë¡</p>
            <p class="text-3xl font-bold text-green-400">${Math.min(total,7)}ì¼</p>
          </div>
        </div>
        
        <button onclick="render('record')" class="mint-btn w-full text-xl py-6 mb-4">
          ğŸ“ ì˜¤ëŠ˜ ê¸°ë¡í•˜ê¸°
        </button>
        
        ${lastRec?`
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-2">ğŸ“Œ ìµœê·¼ ê¸°ë¡</h3>
          <p class="text-sm text-gray-400 mb-1">${lastRec.date}</p>
          <p class="text-sm">ìˆ˜ë©´: ${lastRec.sleep}h | ìš´ë™: ${lastRec.exercise||'ì—†ìŒ'}</p>
          ${lastSymptoms.length>0?`<p class="text-sm mt-1">ì¦ìƒ: ${lastSymptoms.join(', ')}</p>`:''}
        </div>
        `:''}
        
        ${lastSymptoms.length>0?`
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ’Š ì¶”ì²œ ì˜ì–‘ì œ</h3>
          <div class="flex flex-wrap gap-2">
            ${recommendations.supplements.slice(0,4).map(s=>`
              <button onclick="openNaverShopping('${s}')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
                ${s} ğŸ”
              </button>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ¥— ì¶”ì²œ ìŒì‹</h3>
          <div class="flex flex-wrap gap-2">
            ${recommendations.foods.slice(0,4).map(f=>`
              <span class="bg-green-900/40 px-3 py-2 rounded-lg text-sm border border-green-700/50">${f}</span>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">âœ… ì¶”ì²œ ìŠµê´€</h3>
          <div class="space-y-2">
            ${recommendations.habits.slice(0,3).map(h=>`
              <div class="flex items-start gap-2 p-2 bg-gray-800/50 rounded">
                <span class="text-green-400">âœ“</span>
                <span class="text-sm">${h}</span>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-3">ğŸƒ ì¶”ì²œ ìš´ë™</h3>
          <div class="bg-blue-900/40 p-3 rounded-lg border border-blue-700/50">
            <p class="text-sm">${recommendations.exercise}</p>
          </div>
        </div>
        `:`
        <div class="dark-card">
          <h3 class="font-bold mb-2">ğŸ’¡ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
          <p class="text-sm text-gray-400">ì¦ìƒì„ ê¸°ë¡í•˜ë©´ ë§ì¶¤ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        `}
      </div>
      ${navBar('home')}
    `;
  }
  
  else if(page==='record'){
    const lastRec=DB.records[DB.records.length-1];
    const selectedSymptoms=lastRec&&lastRec.symptoms?lastRec.symptoms:[];
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ì˜¤ëŠ˜ì˜ ê¸°ë¡</h2>
        
        <label class="block mb-2 font-bold">ğŸ’¤ ìˆ˜ë©´ ì‹œê°„</label>
        <input type="number" id="sleep" placeholder="7" class="mb-4" step="0.5">
        
        <label class="block mb-2 font-bold">ğŸƒ ìš´ë™</label>
        <select id="exercise" class="mb-4">
          <option value="none">ì•ˆ í•¨</option>
          <option value="walk">ê±·ê¸°</option>
          <option value="run">ë‹¬ë¦¬ê¸°</option>
          <option value="gym">í—¬ìŠ¤</option>
          <option value="yoga">ìš”ê°€</option>
          <option value="swimming">ìˆ˜ì˜</option>
          <option value="cycling">ìì „ê±°</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸº ìŒì£¼</label>
        <select id="drinking" class="mb-4">
          <option value="none">ì•ˆ í•¨</option>
          <option value="week1">ì£¼ 1íšŒ</option>
          <option value="week2-3">ì£¼ 2~3íšŒ</option>
          <option value="week4+">ì£¼ 4íšŒ ì´ìƒ</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸš¬ í¡ì—°</label>
        <select id="smoking" class="mb-4">
          <option value="no">X (ì•ˆ í•¨)</option>
          <option value="yes">O (í•¨)</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸ¥ ë¶ˆí¸í•œ ì¦ìƒ ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</label>
        <div class="mb-4 p-4 bg-gray-800/50 rounded-lg" id="symptomSelector">
          ${SYMPTOMS.map(s=>`
            <span class="symptom-tag ${selectedSymptoms.includes(s)?'selected':''}" onclick="toggleSymptom('${s}')">${s}</span>
          `).join('')}
        </div>
        <div id="selectedSymptomsText" class="text-sm text-gray-400 mb-4"></div>
        
        <label class="block mb-2 font-bold">ğŸ’Š ì˜ì–‘ì œ</label>
        <input type="text" id="supplements" placeholder="ë¹„íƒ€ë¯¼D, ì˜¤ë©”ê°€3" class="mb-4">
        
        <label class="block mb-2 font-bold">ğŸ“ ë©”ëª¨</label>
        <textarea id="note" rows="3" placeholder="ì˜¤ëŠ˜ì˜ ë©”ëª¨" class="mb-6"></textarea>
        
        <button onclick="saveRecord()" class="mint-btn w-full py-4 text-lg">
          ğŸ’¾ ì €ì¥í•˜ê³  ì¶”ì²œë°›ê¸°
        </button>
      </div>
    `;
    updateSelectedSymptoms();
  }
  
  else if(page==='calendar'){
    const filtered=getFilteredDates();
    
    let html=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-4">ìº˜ë¦°ë”</h2>
        
        <div class="mb-4 flex gap-2 flex-wrap">
          <button class="filter-btn ${DB.dateFilter==='1month'?'active':''}" onclick="setDateFilter('1month')">1ê°œì›”</button>
          <button class="filter-btn ${DB.dateFilter==='3month'?'active':''}" onclick="setDateFilter('3month')">3ê°œì›”</button>
          <button class="filter-btn ${DB.dateFilter==='lastmonth'?'active':''}" onclick="setDateFilter('lastmonth')">ì§€ë‚œë‹¬</button>
          <button class="filter-btn" onclick="showDatePicker()">ì§ì ‘ì…ë ¥</button>
        </div>
    `;
    
    const today=new Date();
    const month=today.getMonth();
    const year=today.getFullYear();
    const firstDay=new Date(year,month,1).getDay();
    const daysInMonth=new Date(year,month+1,0).getDate();
    
    html+='<div class="dark-card"><div class="text-center mb-3 font-bold">'+year+'ë…„ '+(month+1)+'ì›”</div><div class="calendar mb-4">';
    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>html+=`<div class="text-center text-xs text-gray-400">${d}</div>`);
    
    for(let i=0;i<firstDay;i++)html+='<div></div>';
    for(let d=1;d<=daysInMonth;d++){
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      const hasRecord=DB.records.some(r=>r.date===dateStr);
      const isToday=d===today.getDate();
      html+=`<div class="cal-day ${hasRecord?'recorded':''} ${isToday?'today':''}" onclick="showDayDetail('${dateStr}')">${d}</div>`;
    }
    html+='</div></div>';
    
    html+='<div class="dark-card"><h3 class="font-bold mb-4">ê¸°ë¡ ëª©ë¡ ('+filtered.length+'ê°œ)</h3>';
    if(filtered.length===0){
      html+='<p class="text-sm text-gray-400">ì„ íƒí•œ ê¸°ê°„ì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
    }else{
      filtered.slice().reverse().forEach(r=>{
        const symptoms=r.symptoms&&r.symptoms.length>0?r.symptoms.join(', '):'ì—†ìŒ';
        html+=`<div class="p-3 mb-2 bg-gray-800 rounded cursor-pointer" onclick="showDayDetail('${r.date}')">
          <p class="text-sm text-gray-400">${r.date}</p>
          <p class="text-sm">ğŸ’¤ ${r.sleep}h | ğŸƒ ${r.exercise||'ì—†ìŒ'}</p>
          <p class="text-sm text-gray-400">ì¦ìƒ: ${symptoms}</p>
        </div>`;
      });
    }
    html+='</div></div>'+navBar('calendar');
    app.innerHTML=html;
  }
  
  else if(page==='analysis'){
    const filtered=getFilteredDates();
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ê±´ê°• ë¶„ì„</h2>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“ˆ ìˆ˜ë©´ ì¶”ì´</h3>
          <canvas id="sleepChart" height="200"></canvas>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“Š í†µê³„</h3>
          <p class="text-sm mb-2">í‰ê·  ìˆ˜ë©´: ${avgSleep()}ì‹œê°„</p>
          <p class="text-sm mb-2">ìš´ë™ ì¼ìˆ˜: ${exerciseDays()}ì¼</p>
          <p class="text-sm">ê°€ì¥ ë§ì€ ì¦ìƒ: ${topSymptom()}</p>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ’Š ì¶”ì²œ ì˜ì–‘ì œ êµ¬ë§¤</h3>
          <p class="text-sm text-gray-400 mb-3">ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤</p>
          <div id="recommendedSupplements"></div>
        </div>
      </div>
      ${navBar('analysis')}
    `;
    
    setTimeout(()=>{
      const ctx=document.getElementById('sleepChart');
      if(ctx&&filtered.length>0){
        new Chart(ctx,{
          type:'line',
          data:{
            labels:filtered.slice(-14).map(r=>r.date.slice(5)),
            datasets:[{
              label:'ìˆ˜ë©´ì‹œê°„',
              data:filtered.slice(-14).map(r=>parseFloat(r.sleep)||0),
              borderColor:'#00d9c0',
              backgroundColor:'rgba(0,217,192,0.1)',
              tension:0.4,
              fill:true
            }]
          },
          options:{
            plugins:{legend:{labels:{color:'#fff'}}},
            scales:{
              y:{ticks:{color:'#fff'},grid:{color:'#333'}},
              x:{ticks:{color:'#fff'},grid:{color:'#333'}}
            }
          }
        });
      }
      showAnalysisRecommendations();
    },100);
  }
  
  else if(page==='profile'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">í”„ë¡œí•„</h2>
        
        <div class="dark-card">
          <label class="block mb-2 font-bold">ì´ë¦„</label>
          <input type="text" id="name" value="${DB.profile.name}" class="mb-4">
          
          <label class="block mb-2 font-bold">ë‚˜ì´</label>
          <input type="number" id="age" value="${DB.profile.age||''}" class="mb-4">
          
          <label class="block mb-2 font-bold">ì„±ë³„</label>
          <select id="gender" class="mb-4">
            <option value="" ${!DB.profile.gender?'selected':''}>ì„ íƒ</option>
            <option value="male" ${DB.profile.gender==='male'?'selected':''}>ë‚¨ì„±</option>
            <option value="female" ${DB.profile.gender==='female'?'selected':''}>ì—¬ì„±</option>
          </select>
          
          <label class="block mb-2 font-bold">í‚¤ (cm)</label>
          <input type="number" id="height" value="${DB.profile.height||''}" class="mb-4">
          
          <label class="block mb-2 font-bold">ëª¸ë¬´ê²Œ (kg)</label>
          <input type="number" id="weight" value="${DB.profile.weight||''}" class="mb-4">
          
          <button onclick="calcBMI()" class="w-full bg-gray-700 py-3 rounded-lg mb-4">BMI ê³„ì‚°</button>
          <div id="bmiResult" class="text-center p-4 bg-gray-800 rounded hidden"></div>
        </div>
        
        <button onclick="saveProfile()" class="mint-btn w-full py-4 mt-4">
          ğŸ’¾ ì €ì¥í•˜ê¸°
        </button>
      </div>
      ${navBar('profile')}
    `;
  }
  
  else if(page==='community'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <h2 class="text-2xl font-bold mb-6">ì»¤ë®¤ë‹ˆí‹°</h2>
        
        <div class="dark-card mb-4">
          <textarea id="newPost" rows="3" placeholder="ê±´ê°• ì •ë³´ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!" class="mb-2"></textarea>
          <button onclick="addPost()" class="mint-btn w-full py-3">ê²Œì‹œí•˜ê¸°</button>
        </div>
        
        <div id="postList">
          ${DB.posts.map((p,i)=>`
            <div class="dark-card">
              <p class="mb-2">${p.text}</p>
              <div class="flex gap-4 text-sm text-gray-400">
                <button onclick="likePost(${i})" class="hover:text-red-400">â¤ï¸ ${p.likes||0}</button>
                <span>ğŸ’¬ ${p.comments||0}</span>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
      ${navBar('community')}
    `;
  }
}

function navBar(active){
  return `<div class="nav"><div class="flex">
    <button onclick="render('home')" class="${active==='home'?'active':''}">ğŸ <br><span class="text-xs">í™ˆ</span></button>
    <button onclick="render('record')" class="${active==='record'?'active':''}">â•<br><span class="text-xs">ê¸°ë¡</span></button>
    <button onclick="render('calendar')" class="${active==='calendar'?'active':''}">ğŸ“…<br><span class="text-xs">ìº˜ë¦°ë”</span></button>
    <button onclick="render('analysis')" class="${active==='analysis'?'active':''}">ğŸ“Š<br><span class="text-xs">ë¶„ì„</span></button>
    <button onclick="render('profile')" class="${active==='profile'?'active':''}">ğŸ‘¤<br><span class="text-xs">í”„ë¡œí•„</span></button>
  </div></div>`;
}

let selectedSymptoms=[];

function toggleSymptom(symptom){
  const idx=selectedSymptoms.indexOf(symptom);
  if(idx>-1){
    selectedSymptoms.splice(idx,1);
  }else{
    selectedSymptoms.push(symptom);
  }
  updateSelectedSymptoms();
}

function updateSelectedSymptoms(){
  const tags=document.querySelectorAll('.symptom-tag');
  tags.forEach(tag=>{
    const symptom=tag.textContent;
    if(selectedSymptoms.includes(symptom)){
      tag.classList.add('selected');
    }else{
      tag.classList.remove('selected');
    }
  });
  
  const text=document.getElementById('selectedSymptomsText');
  if(text){
    if(selectedSymptoms.length>0){
      text.textContent='ì„ íƒë¨: '+selectedSymptoms.join(', ');
      text.classList.remove('text-gray-400');
      text.classList.add('text-green-400');
    }else{
      text.textContent='ì¦ìƒì„ ì„ íƒí•˜ì„¸ìš”';
      text.classList.add('text-gray-400');
      text.classList.remove('text-green-400');
    }
  }
}

function saveRecord(){
  const rec={
    date:new Date().toISOString().split('T')[0],
    sleep:document.getElementById('sleep').value,
    exercise:document.getElementById('exercise').value,
    drinking:document.getElementById('drinking').value,
    smoking:document.getElementById('smoking').value,
    symptoms:[...selectedSymptoms],
    supplements:document.getElementById('supplements').value,
    note:document.getElementById('note').value
  };
  DB.records.push(rec);
  save();
  selectedSymptoms=[];
  alert('âœ… ê¸°ë¡ ì™„ë£Œ! ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš”.');
  render('home');
}

function saveProfile(){
  DB.profile.name=document.getElementById('name').value;
  DB.profile.age=document.getElementById('age').value;
  DB.profile.gender=document.getElementById('gender').value;
  DB.profile.height=document.getElementById('height').value;
  DB.profile.weight=document.getElementById('weight').value;
  save();
  alert('âœ… í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!');
}

function calcBMI(){
  const h=parseFloat(DB.profile.height)/100;
  const w=parseFloat(DB.profile.weight);
  if(h&&w){
    const bmi=(w/(h*h)).toFixed(1);
    let cat='';
    if(bmi<18.5)cat='ì €ì²´ì¤‘';
    else if(bmi<23)cat='ì •ìƒ';
    else if(bmi<25)cat='ê³¼ì²´ì¤‘';
    else cat='ë¹„ë§Œ';
    document.getElementById('bmiResult').innerHTML=`<p class="text-3xl font-bold text-green-400">${bmi}</p><p class="text-sm text-gray-400">${cat}</p>`;
    document.getElementById('bmiResult').classList.remove('hidden');
  }
}

function setDateFilter(filter){
  DB.dateFilter=filter;
  save();
  render('calendar');
}

function showDatePicker(){
  const start=prompt('ì‹œì‘ ë‚ ì§œ (YYYY-MM-DD):');
  const end=prompt('ì¢…ë£Œ ë‚ ì§œ (YYYY-MM-DD):');
  if(start&&end){
    DB.dateFilter='custom';
    DB.customStart=start;
    DB.customEnd=end;
    save();
    render('calendar');
  }
}

function showDayDetail(date){
  const rec=DB.records.find(r=>r.date===date);
  if(rec){
    const symptoms=rec.symptoms&&rec.symptoms.length>0?rec.symptoms.join(', '):'ì—†ìŒ';
    alert(`ğŸ“… ${date}\n\nğŸ’¤ ìˆ˜ë©´: ${rec.sleep}h\nğŸƒ ìš´ë™: ${rec.exercise||'ì—†ìŒ'}\nğŸº ìŒì£¼: ${rec.drinking||'ì—†ìŒ'}\nğŸš¬ í¡ì—°: ${rec.smoking||'ì—†ìŒ'}\nğŸ¥ ì¦ìƒ: ${symptoms}\nğŸ’Š ì˜ì–‘ì œ: ${rec.supplements||'ì—†ìŒ'}\nğŸ“ ë©”ëª¨: ${rec.note||'ì—†ìŒ'}`);
  }
}

function avgSleep(){
  if(DB.records.length===0)return 0;
  const sum=DB.records.reduce((a,r)=>a+parseFloat(r.sleep||0),0);
  return(sum/DB.records.length).toFixed(1);
}

function exerciseDays(){
  return DB.records.filter(r=>r.exercise&&r.exercise!=='none').length;
}

function topSymptom(){
  const counts={};
  DB.records.forEach(r=>{
    if(r.symptoms&&r.symptoms.length>0){
      r.symptoms.forEach(s=>counts[s]=(counts[s]||0)+1);
    }
  });
  const top=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
  return top?top[0]:'ì—†ìŒ';
}

function showAnalysisRecommendations(){
  const topSym=topSymptom();
  if(topSym==='ì—†ìŒ'){
    document.getElementById('recommendedSupplements').innerHTML='<p class="text-sm text-gray-400">ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>';
    return;
  }
  
  const rule=RULES.find(r=>r.c===topSym);
  if(rule){
    const html=rule.s.slice(0,4).map(s=>`
      <button onclick="openNaverShopping('${s}')" class="w-full mb-2 p-3 bg-purple-900/40 rounded-lg border border-purple-700/50 hover:bg-purple-800/40 text-left flex justify-between items-center">
        <span>${s}</span>
        <span class="text-sm">ê²€ìƒ‰ â†’</span>
      </button>
    `).join('');
    document.getElementById('recommendedSupplements').innerHTML=html;
  }
}

function openNaverShopping(keyword){
  window.open(`https://search.shopping.naver.com/search/all?query=${encodeURIComponent(keyword)}`,'_blank');
}

function addPost(){
  const text=document.getElementById('newPost').value;
  if(text){
    DB.posts.unshift({text,likes:0,comments:0,date:new Date().toLocaleDateString()});
    save();
    render('community');
  }
}

function likePost(i){
  DB.posts[i].likes=(DB.posts[i].likes||0)+1;
  save();
  render('community');
}

// ì´ˆê¸° ë Œë”ë§
render('home');
</script>
</body>
</html>
