<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ëª¸ì¼ê¸° v3.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:#1a1a1a;color:#fff;overflow-x:hidden}
.app{max-width:480px;margin:0 auto;min-height:100vh}
.page{display:none}
.page.active{display:block;animation:fadeIn 0.3s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes sparkle{0%,100%{transform:scale(1) rotate(0deg);opacity:1}50%{transform:scale(1.2) rotate(180deg);opacity:0.8}}
.splash{position:fixed;inset:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
.onboarding{position:fixed;inset:0;background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9998;padding:40px 20px}
.onboarding-icon{font-size:80px;margin-bottom:30px}
.onboarding-icon.pulse{animation:pulse 2s ease-in-out infinite}
.onboarding-icon.spin{animation:spin 3s linear infinite}
.onboarding-icon.sparkle{animation:sparkle 2s ease-in-out infinite}
.onboarding-title{font-size:28px;font-weight:bold;color:#fff;margin-bottom:15px;text-align:center}
.onboarding-desc{font-size:16px;color:#aaa;text-align:center;line-height:1.6;max-width:300px}
.onboarding-dots{display:flex;gap:10px;margin:40px 0;justify-content:center}
.onboarding-dot{width:10px;height:10px;border-radius:50%;background:#555;transition:all 0.3s}
.onboarding-dot.active{background:#00d9c0;width:30px;border-radius:5px}
.onboarding-buttons{display:flex;gap:15px;width:100%;max-width:300px;margin-top:30px}
.logo{width:120px;height:120px;background:white;border-radius:30px;display:flex;align-items:center;justify-content:center;animation:float 3s ease-in-out infinite;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
.logo-text{font-size:48px;font-weight:900;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.mint-btn{background:#00d9c0;color:#000;font-weight:700;padding:12px 24px;border-radius:12px;border:none;cursor:pointer}
.dark-card{background:#2a2a2a;border-radius:16px;padding:20px;margin:10px 0}
.nav{position:fixed;bottom:0;left:0;right:0;background:#1f1f1f;border-top:1px solid#333;max-width:480px;margin:0 auto}
.nav button{flex:1;padding:8px;background:none;border:none;color:#888;cursor:pointer;font-size:10px}
.nav button.active{color:#00d9c0}
input,select,textarea{background:#2a2a2a;border:1px solid#3a3a3a;color:#fff;padding:12px;border-radius:8px;width:100%;margin:8px 0;transition:border-color 0.3s}
input:focus,select:focus,textarea:focus{outline:none;border-color:#00d9c0}
input.error{border-color:#ff4444;animation:shake 0.3s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
button{transition:all 0.2s;cursor:pointer}
button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,217,192,0.3)}
button:active{transform:translateY(0)}
.mint-btn:hover{background:#00ffd5}
.dark-card{background:#2a2a2a;border-radius:16px;padding:20px;margin:10px 0;transition:all 0.3s}
.dark-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.3)}
.toast{position:fixed;top:20px;right:20px;background:#2a2a2a;color:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.5);z-index:10000;animation:slideIn 0.3s;min-width:250px;border-left:4px solid #00d9c0}
.toast.success{border-left-color:#00d9c0}
.toast.error{border-left-color:#ff4444}
.toast.warning{border-left-color:#ffa500}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}
.empty-state{text-align:center;padding:60px 20px;color:#888}
.empty-state-icon{font-size:60px;margin-bottom:20px;opacity:0.5}
.health-score{font-size:48px;font-weight:bold;background:linear-gradient(135deg,#00d9c0,#00ffd5);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.score-circle{width:120px;height:120px;border-radius:50%;background:conic-gradient(#00d9c0 0deg,#00d9c0 calc(var(--score)*3.6deg),#3a3a3a calc(var(--score)*3.6deg),#3a3a3a 360deg);display:flex;align-items:center;justify-content:center;margin:0 auto}
.score-inner{width:100px;height:100px;border-radius:50%;background:#2a2a2a;display:flex;align-items:center;justify-content:center;flex-direction:column}
.todo-item{display:flex;align-items:center;gap:12px;padding:12px;background:#3a3a3a;border-radius:8px;margin:8px 0;cursor:pointer;transition:all 0.2s}
.todo-item:hover{background:#4a4a4a}
.todo-item.completed{opacity:0.6}
.todo-checkbox{width:24px;height:24px;border:2px solid#00d9c0;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.todo-item.completed .todo-checkbox{background:#00d9c0}
.supp-item{background:#2a2a2a;padding:12px;border-radius:8px;margin:8px 0;border-left:4px solid #00d9c0;display:flex;align-items:center;gap:12px}
.supp-checkbox{width:20px;height:20px;border:2px solid#00d9c0;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.supp-checkbox.checked{background:#00d9c0}
.search-bar{background:#2a2a2a;border:2px solid#3a3a3a;color:#fff;padding:12px 16px;border-radius:12px;width:100%;margin:8px 0;transition:border-color 0.3s}
.search-bar:focus{outline:none;border-color:#00d9c0}
.tip-card{background:linear-gradient(135deg,#00d9c0,#00ffd5);color:#000;padding:16px;border-radius:12px;text-align:center;font-weight:bold;margin:10px 0}
.error-message{color:#ff4444;font-size:12px;margin-top:4px;display:none}
.error-message.show{display:block}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;background:#2a2a2a;font-size:14px}
.cal-day.recorded{background:#00d9c0;color:#000;font-weight:bold}
.cal-day.today{border:2px solid#00d9c0}
.symptom-tag{display:inline-block;background:#3a3a3a;padding:8px 12px;border-radius:20px;margin:4px;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.symptom-tag.selected{background:#00d9c0;color:#000;border-color:#00d9c0;font-weight:bold}
.filter-btn{background:#3a3a3a;padding:8px 16px;border-radius:8px;border:none;color:#fff;cursor:pointer;margin:4px}
.filter-btn.active{background:#00d9c0;color:#000;font-weight:bold}
.tab-btn{padding:12px 20px;border:none;background:none;cursor:pointer;transition:all 0.2s}
.goal-progress{background:#3a3a3a;border-radius:10px;height:8px;overflow:hidden}
.goal-fill{background:linear-gradient(90deg,#00d9c0,#00ffd5);height:100%;transition:width 0.5s}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:999}
.modal-content{background:#2a2a2a;border-radius:16px;padding:24px;max-width:400px;width:90%;max-height:80vh;overflow-y:auto}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ë°ì´í„° êµ¬ì¡°
let DB={
  records:[],
  profile:{name:'ì‚¬ìš©ì',age:30,gender:'',height:170,weight:65},
  communityTab:'popular',
  communityPosts:null,
  communityComments:null,
  dateFilter:'1month',
  goals:{sleep:7,exercise:3,water:8},
  todos:[
    {id:1,text:'ì˜ì–‘ì œ ë³µìš©',icon:'ğŸ’Š',completed:false},
    {id:2,text:'ë¬¼ 8ì” ë§ˆì‹œê¸°',icon:'ğŸ’§',completed:false},
    {id:3,text:'20ë¶„ ìš´ë™í•˜ê¸°',icon:'ğŸƒ',completed:false}
  ],
  dailyTodoStatus:{},
  supplements:[
    {id:1,name:'ë¹„íƒ€ë¯¼D',time:'ì•„ì¹¨',dose:'1ì •'},
    {id:2,name:'ì˜¤ë©”ê°€3',time:'ì €ë…',dose:'1ì •'},
    {id:3,name:'ë§ˆê·¸ë„¤ìŠ˜',time:'ì €ë…',dose:'1ì •'}
  ],
  dailySuppStatus:{}
};

// í™•ì¥ëœ RULE ë°ì´í„°ë² ì´ìŠ¤
const RULES=[
  {c:"ë³€ë¹„",s:["í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤","í”„ë¦¬ë°”ì´ì˜¤í‹±ìŠ¤","ë§ˆê·¸ë„¤ìŠ˜"],f:["ê·€ë¦¬","ìš”ê±°íŠ¸","ë¸”ë£¨ë² ë¦¬","ì‚¬ê³¼"],h:["ì‹í›„ 20ë¶„ ì‚°ì±…","ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨"],e:"ìŠ¤íŠ¸ë ˆì¹­ 15ë¶„"},
  {c:"í”¼ë¡œ",s:["ë¹„íƒ€ë¯¼Bë³µí•©ì²´","ì½”ì—”ìì„Q10","ì² ë¶„","ì¸ì‚¼"],f:["ì‹œê¸ˆì¹˜","ê²¬ê³¼ë¥˜","ì—°ì–´","ê·€ë¦¬"],h:["ì¶©ë¶„í•œ ìˆ˜ë©´","ê·œì¹™ì ì¸ ì‹ì‚¬"],e:"ê±·ê¸° 20ë¶„"},
  {c:"ë¶ˆë©´ì¦",s:["ë©œë¼í† ë‹Œ","ë§ˆê·¸ë„¤ìŠ˜","í…Œì•„ë‹Œ","ë°œë ˆë¦¬ì•ˆ"],f:["ë°”ë‚˜ë‚˜","ìš°ìœ ","í˜¸ë‘","ì²´ë¦¬"],h:["ì·¨ì¹¨ 1ì‹œê°„ ì „ ìŠ¤ë§ˆíŠ¸í° ê¸ˆì§€","ê·œì¹™ì ì¸ ì·¨ì¹¨ ì‹œê°„"],e:"ìš”ê°€ 30ë¶„"},
  {c:"ë‘í†µ",s:["ë§ˆê·¸ë„¤ìŠ˜","ë¹„íƒ€ë¯¼B2","ì½”ì—”ìì„Q10"],f:["ë¬¼","ì‹œê¸ˆì¹˜","ì•„ëª¬ë“œ"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ê·œì¹™ì ì¸ ì‹ì‚¬","ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬"],e:"ëª©/ì–´ê¹¨ ìŠ¤íŠ¸ë ˆì¹­ 10ë¶„"},
  {c:"ìŠ¤íŠ¸ë ˆìŠ¤",s:["ë§ˆê·¸ë„¤ìŠ˜","í…Œì•„ë‹Œ","ë¡œë””ì˜¬ë¼"],f:["ë°”ë‚˜ë‚˜","ì•„ëª¬ë“œ","ë‹¤í¬ì´ˆì½œë¦¿"],h:["ëª…ìƒ 10ë¶„","ì¶©ë¶„í•œ ìˆ˜ë©´","í˜¸í¡ ìš´ë™"],e:"ìš”ê°€ 20ë¶„"},
  {c:"ì†Œí™”ë¶ˆëŸ‰",s:["ì†Œí™”íš¨ì†Œ","í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤","ìƒê°•"],f:["ì–‘ë°°ì¶”","ìƒê°•ì°¨","ë°”ë‚˜ë‚˜"],h:["ì²œì²œíˆ ë¨¹ê¸°","ì‹ì‚¬ í›„ ëˆ•ì§€ ì•Šê¸°"],e:"ì‹í›„ ê°€ë²¼ìš´ ì‚°ì±… 10ë¶„"},
  {c:"ê·¼ìœ¡í†µ",s:["ë§ˆê·¸ë„¤ìŠ˜","BCAA","ì˜¤ë©”ê°€3"],f:["ê³„ë€","ë‹­ê°€ìŠ´ì‚´","ë°”ë‚˜ë‚˜"],h:["ì¶©ë¶„í•œ ìŠ¤íŠ¸ë ˆì¹­","íšŒë³µ ì‹œê°„"],e:"ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­"},
  {c:"ê´€ì ˆí†µ",s:["ê¸€ë£¨ì½”ì‚¬ë¯¼","ì½˜ë“œë¡œì´ì¹œ","ì˜¤ë©”ê°€3"],f:["ì—°ì–´","ì²´ë¦¬","ìƒê°•"],h:["ì²´ì¤‘ ê´€ë¦¬","ê´€ì ˆ ë³´í˜¸"],e:"ìˆ˜ì˜"},
  {c:"í”¼ë¶€ê±´ì¡°",s:["ì˜¤ë©”ê°€3","ë¹„íƒ€ë¯¼E","íˆì•Œë£¨ë¡ ì‚°"],f:["ì•„ë³´ì¹´ë„","ê²¬ê³¼ë¥˜","ì—°ì–´"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ë³´ìŠµì œ ì‚¬ìš©"],e:"ê±·ê¸° 20ë¶„"},
  {c:"ì§‘ì¤‘ë ¥ì €í•˜",s:["ì˜¤ë©”ê°€3","ì€í–‰ìì¶”ì¶œë¬¼","ë¹„íƒ€ë¯¼B"],f:["ë¸”ë£¨ë² ë¦¬","í˜¸ë‘","ì•„ë³´ì¹´ë„"],h:["ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨","ê·œì¹™ì ì¸ íœ´ì‹"],e:"ê±·ê¸° 20ë¶„"}
];

const SYMPTOMS=["ë³€ë¹„","í”¼ë¡œ","ë¶ˆë©´ì¦","ë‘í†µ","ìŠ¤íŠ¸ë ˆìŠ¤","ì†Œí™”ë¶ˆëŸ‰","ê·¼ìœ¡í†µ","ê´€ì ˆí†µ","í”¼ë¶€ê±´ì¡°","ì§‘ì¤‘ë ¥ì €í•˜"];

// ì˜¤ëŠ˜ì˜ ê±´ê°• íŒ (50ê°œ)
const HEALTH_TIPS=[
  "ë¬¼ 8ì” ë§ˆì‹œê¸° ë„ì „! ğŸ’§","ê³„ë‹¨ ì´ìš©í•˜ê¸° ğŸš¶","10ë¶„ ìŠ¤íŠ¸ë ˆì¹­ ğŸ¤¸","ê³¼ì¼ 1ê°œ ë¨¹ê¸° ğŸ",
  "20ë¶„ ì‚°ì±…í•˜ê¸° ğŸŒ³","ì‹¬í˜¸í¡ 5íšŒ ğŸ§˜","11ì‹œ ì „ ì·¨ì¹¨ ğŸ˜´","ì•„ì¹¨ ì‹ì‚¬ ê¼­ í•˜ê¸° ğŸ³",
  "í•¸ë“œí° ëœ ë³´ê¸° ğŸ“±","í–‡ë¹› ì¬ê¸° â˜€ï¸","ë¬¼ë³‘ í•­ìƒ ì±™ê¸°ê¸° ğŸ’§","ì •í¬í‘¸ë“œ í”¼í•˜ê¸° ğŸ”",
  "ìŠ¤ì¿¼íŠ¸ 20ê°œ ğŸ’ª","ì±„ì†Œ ë¨¹ê¸° ğŸ¥¬","ê°ì‚¬ ì¼ê¸° ì“°ê¸° âœï¸","ì›ƒê¸° ğŸ˜Š",
  "ëª…ìƒ 5ë¶„ ğŸ§˜","ìŒì•… ë“£ê¸° ğŸµ","ì¹œêµ¬ì™€ í†µí™” ğŸ“","ë…ì„œ 30ë¶„ ğŸ“š",
  "ìš”ê°€ 15ë¶„ ğŸ§˜â€â™€ï¸","í”Œë­í¬ 1ë¶„ ğŸ¤¸","ì¤„ë„˜ê¸° 100ê°œ ğŸƒ","ìì„¸ ë°”ë¥´ê²Œ ì•‰ê¸° ğŸª‘",
  "ëˆˆ ìš´ë™í•˜ê¸° ğŸ‘€","ëª© ìŠ¤íŠ¸ë ˆì¹­ ğŸ’†","ì–´ê¹¨ ëŒë¦¬ê¸° ğŸ¤·","ë°œëª© ëŒë¦¬ê¸° ğŸ¦¶",
  "ë…¹ì°¨ ë§ˆì‹œê¸° ğŸµ","ê²¬ê³¼ë¥˜ í•œ ì¤Œ ğŸ¥œ","ë°œíš¨ì‹í’ˆ ë¨¹ê¸° ğŸ¥˜","ì‹ì´ì„¬ìœ  ì±™ê¸°ê¸° ğŸ¥—",
  "ë‹¨ë°±ì§ˆ ì„­ì·¨ ğŸ—","ë¹„íƒ€ë¯¼D ë³´ì¶© â˜€ï¸","ì˜¤ë©”ê°€3 ì±™ê¸°ê¸° ğŸŸ","í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤ ğŸ’Š",
  "ì €ì—¼ì‹ ì‹¤ì²œí•˜ê¸° ğŸ§‚","ì €ë‹¹ ê°„ì‹ ì„ íƒ ğŸ¬","ì²œì²œíˆ ì”¹ê¸° ğŸ½ï¸","ì‹ì‚¬ ì‹œê°„ ì§€í‚¤ê¸° â°",
  "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ğŸ§ ","ê¸ì •ì  ìƒê° ğŸ’­","ì·¨ë¯¸ ìƒí™œ ğŸ¨","ë°˜ë ¤ë™ë¬¼ê³¼ ë†€ê¸° ğŸ•",
  "ì²­ì†Œí•˜ê¸° ğŸ§¹","ì •ë¦¬ì •ëˆ ğŸ“¦","í™˜ê¸°í•˜ê¸° ğŸªŸ","ê°€ìŠµê¸° ì¼œê¸° ğŸ’¨",
  "ë³´ìŠµì œ ë°”ë¥´ê¸° ğŸ§´","ìì™¸ì„  ì°¨ë‹¨ ğŸŒ"
];

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
function load(){
  const d=localStorage.getItem('mybodydata');
  if(d){
    const loaded=JSON.parse(d);
    DB={...DB,...loaded};
  }
}
function save(){localStorage.setItem('mybodydata',JSON.stringify(DB))}

load();

// ìŠ¤í”Œë˜ì‹œ í™”ë©´ ì²´í¬
const splashShown=sessionStorage.getItem('splashShown');
const onboardingDone=localStorage.getItem('onboardingDone');

if(!splashShown){
  // ì„¸ì…˜ ì¤‘ ì²˜ìŒ ë°©ë¬¸ - ìŠ¤í”Œë˜ì‹œ í‘œì‹œ
  document.body.innerHTML=`
    <div class="splash">
      <div class="logo">
        <div class="logo-text">ğŸ’ª</div>
      </div>
      <h1 class="text-4xl font-bold mt-6 text-white">ë‚´ëª¸ì¼ê¸°</h1>
      <p class="text-white/80 mt-2">ë‹¹ì‹ ì˜ ê±´ê°•ì„ ê¸°ë¡í•©ë‹ˆë‹¤</p>
    </div>
  `;
  setTimeout(()=>{
    sessionStorage.setItem('splashShown','true');
    location.reload();
  },2500);
}else if(!onboardingDone){
  // ìŠ¤í”Œë˜ì‹œ ë³¸ í›„ ì˜¨ë³´ë”© í‘œì‹œ
  showOnboarding();
}else{
  // ë©”ì¸ ì•± ì‹œì‘
  render('home');
}

function showOnboarding(){
  let currentStep=0;
  const steps=[
    {
      icon:'ğŸ“',
      animation:'pulse',
      title:'ë§¤ì¼ 3ë¶„, ê±´ê°• ê¸°ë¡í•˜ê¸°',
      desc:'ìˆ˜ë©´Â·ì‹ìŠµê´€Â·ì¦ìƒì„\nê°„í¸í•˜ê²Œ ê¸°ë¡í•˜ì„¸ìš”'
    },
    {
      icon:'ğŸ¯',
      animation:'spin',
      title:'AI ë§ì¶¤ ì¶”ì²œ',
      desc:'ì¦ìƒì— ë§ëŠ” ì˜ì–‘ì œÂ·ìŒì‹Â·ìš´ë™ì„\nìë™ ì¶”ì²œë°›ìœ¼ì„¸ìš”'
    },
    {
      icon:'ğŸ†',
      animation:'sparkle',
      title:'ê±´ê°•í•œ ìŠµê´€ ì™„ì„±',
      desc:'ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ë‹¬ì„±ë¥ ì„\ní™•ì¸í•˜ë©° ì„±ì¥í•˜ì„¸ìš”'
    }
  ];
  
  function renderStep(){
    const step=steps[currentStep];
    const isLast=currentStep===steps.length-1;
    
    document.body.innerHTML=`
      <div class="onboarding">
        <div class="onboarding-icon ${step.animation}">${step.icon}</div>
        <h2 class="onboarding-title">${step.title}</h2>
        <p class="onboarding-desc">${step.desc.replace(/\n/g,'<br>')}</p>
        
        <div class="onboarding-dots">
          ${steps.map((s,i)=>`<div class="onboarding-dot ${i===currentStep?'active':''}"></div>`).join('')}
        </div>
        
        <div class="onboarding-buttons">
          ${!isLast?`<button onclick="skipOnboarding()" class="flex-1 bg-gray-700 py-3 rounded-xl text-white">ê±´ë„ˆë›°ê¸°</button>`:''}
          <button onclick="${isLast?'finishOnboarding':'nextOnboarding'}()" class="flex-1 mint-btn py-3 rounded-xl">
            ${isLast?'ì‹œì‘í•˜ê¸°! ğŸš€':'ë‹¤ìŒ â†’'}
          </button>
        </div>
      </div>
    `;
  }
  
  window.nextOnboarding=()=>{
    currentStep++;
    renderStep();
  };
  
  window.skipOnboarding=()=>{
    localStorage.setItem('onboardingDone','true');
    document.body.innerHTML='<div class="app" id="app"></div>';
    render('home');
  };
  
  window.finishOnboarding=()=>{
    localStorage.setItem('onboardingDone','true');
    const onboarding=document.querySelector('.onboarding');
    if(onboarding){
      onboarding.style.opacity='1';
      onboarding.style.transition='opacity 0.3s';
      onboarding.style.opacity='0';
      setTimeout(()=>{
        document.body.innerHTML='<div class="app" id="app"></div>';
        render('home');
      },300);
    }else{
      document.body.innerHTML='<div class="app" id="app"></div>';
      render('home');
    }
  };
  
  renderStep();
}

// ë‚ ì§œ í•„í„° ê³„ì‚°
function getFilteredDates(){
  const today=new Date();
  const start=new Date();
  
  if(DB.dateFilter==='1month'){
    start.setMonth(start.getMonth()-1);
  }else if(DB.dateFilter==='3month'){
    start.setMonth(start.getMonth()-3);
  }else if(DB.dateFilter==='lastmonth'){
    start.setMonth(start.getMonth()-1);
    start.setDate(1);
    today.setDate(0);
  }
  
  return DB.records.filter(r=>{
    const d=new Date(r.date);
    return d>=start&&d<=today;
  });
}

// í˜ì´ì§€ ë Œë”ë§
function render(page){
  const app=document.getElementById('app');
  
  if(page==='home'){
    const total=DB.records.length;
    const lastRec=DB.records[DB.records.length-1];
    const lastSymptoms=lastRec&&lastRec.symptoms?lastRec.symptoms:[];
    
    // ê±´ê°• ì ìˆ˜ ê³„ì‚° (0-100ì )
    const weekRecords=DB.records.filter(r=>{
      const d=new Date(r.date);
      const weekAgo=new Date();
      weekAgo.setDate(weekAgo.getDate()-7);
      return d>=weekAgo;
    });
    
    const avgSleepWeek=weekRecords.length>0?
      (weekRecords.reduce((a,r)=>a+parseFloat(r.sleep||0),0)/weekRecords.length):0;
    const exerciseCount=weekRecords.filter(r=>r.exercise&&r.exercise!=='none').length;
    const recordStreak=Math.min(total,7);
    
    // ê±´ê°• ì ìˆ˜ (40ì : ìˆ˜ë©´, 30ì : ìš´ë™, 30ì : ê¸°ë¡)
    let healthScore=0;
    if(avgSleepWeek>=7)healthScore+=40;
    else if(avgSleepWeek>=6)healthScore+=30;
    else if(avgSleepWeek>=5)healthScore+=20;
    else healthScore+=10;
    
    if(exerciseCount>=3)healthScore+=30;
    else if(exerciseCount>=2)healthScore+=20;
    else if(exerciseCount>=1)healthScore+=10;
    
    if(recordStreak>=7)healthScore+=30;
    else if(recordStreak>=5)healthScore+=20;
    else if(recordStreak>=3)healthScore+=10;
    
    // ì˜¤ëŠ˜ì˜ ê±´ê°• íŒ (ëœë¤)
    const todayTip=HEALTH_TIPS[Math.floor(Math.random()*HEALTH_TIPS.length)];
    
    // ì˜¤ëŠ˜ í•  ì¼ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
    const today=new Date().toISOString().split('T')[0];
    if(!DB.dailyTodoStatus[today]){
      DB.dailyTodoStatus[today]=DB.todos.map(t=>({id:t.id,completed:false}));
    }
    const todayTodos=DB.dailyTodoStatus[today];
    
    const sleepProgress=Math.min((avgSleepWeek/DB.goals.sleep)*100,100);
    const exerciseProgress=Math.min((exerciseCount/DB.goals.exercise)*100,100);
    
    // ì¦ìƒ ê¸°ë°˜ ì¶”ì²œ ìƒì„±
    let recommendations={supplements:[],foods:[],habits:[],exercise:''};
    if(lastSymptoms.length>0){
      lastSymptoms.forEach(sym=>{
        const rule=RULES.find(r=>r.c===sym);
        if(rule){
          recommendations.supplements.push(...rule.s);
          recommendations.foods.push(...rule.f);
          recommendations.habits.push(...rule.h);
          if(!recommendations.exercise)recommendations.exercise=rule.e;
        }
      });
      recommendations.supplements=[...new Set(recommendations.supplements)];
      recommendations.foods=[...new Set(recommendations.foods)];
      recommendations.habits=[...new Set(recommendations.habits)];
    }
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h1 class="text-3xl font-bold mb-1">ë‚´ëª¸ì¼ê¸°</h1>
            <p class="text-gray-400">ì•ˆë…•í•˜ì„¸ìš”, ${DB.profile.name}ë‹˜! ğŸ‘‹</p>
          </div>
          <button onclick="render('profile')" class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-xl">
            ğŸ‘¤
          </button>
        </div>
        
        <!-- ê±´ê°• ì ìˆ˜ -->
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4 text-center">ğŸ† ë‚´ ê±´ê°• ì ìˆ˜</h3>
          <div class="score-circle mx-auto mb-4" style="--score:${healthScore}">
            <div class="score-inner">
              <div class="health-score">${healthScore}</div>
              <p class="text-xs text-gray-400">ì </p>
            </div>
          </div>
          <div class="text-center text-sm text-gray-400">
            ${healthScore>=80?'ğŸ‰ í›Œë¥­í•´ìš”!':healthScore>=60?'ğŸ‘ ì˜í•˜ê³  ìˆì–´ìš”!':healthScore>=40?'ğŸ’ª ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ìš”!':'ğŸŒ± ì‹œì‘ì´ ë°˜ì´ì—ìš”!'}
          </div>
          <div class="grid grid-cols-3 gap-2 mt-4 text-xs text-center">
            <div>
              <p class="text-gray-400">ìˆ˜ë©´</p>
              <p class="font-bold text-blue-400">${avgSleepWeek>=7?'âœ“':avgSleepWeek>=5?'â–³':'â—‹'} ${avgSleepWeek.toFixed(1)}h</p>
            </div>
            <div>
              <p class="text-gray-400">ìš´ë™</p>
              <p class="font-bold text-green-400">${exerciseCount>=3?'âœ“':exerciseCount>=1?'â–³':'â—‹'} ${exerciseCount}íšŒ</p>
            </div>
            <div>
              <p class="text-gray-400">ê¸°ë¡</p>
              <p class="font-bold text-purple-400">${recordStreak>=7?'âœ“':recordStreak>=3?'â–³':'â—‹'} ${recordStreak}ì¼</p>
            </div>
          </div>
        </div>
        
        <!-- ì˜¤ëŠ˜ì˜ ê±´ê°• íŒ -->
        <div class="tip-card mb-4">
          ğŸ’¡ ì˜¤ëŠ˜ì˜ íŒ: ${todayTip}
        </div>
        
        <!-- ì˜¤ëŠ˜ í•  ì¼ -->
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ“‹ ì˜¤ëŠ˜ í•  ì¼</h3>
          <div class="space-y-2">
            ${DB.todos.map((todo,idx)=>{
              const status=todayTodos.find(t=>t.id===todo.id);
              const isCompleted=status?status.completed:false;
              return `
                <div class="todo-item ${isCompleted?'completed':''}" onclick="toggleTodo(${todo.id})">
                  <div class="todo-checkbox">
                    ${isCompleted?'âœ“':''}
                  </div>
                  <span>${todo.icon} ${todo.text}</span>
                </div>
              `;
            }).join('')}
          </div>
          <button onclick="render('manageTodos')" class="text-xs text-gray-400 hover:text-green-400 mt-2">í•  ì¼ ê´€ë¦¬ â†’</button>
        </div>
        
        <button onclick="render('record')" class="mint-btn w-full text-xl py-6 mb-4">
          ğŸ“ ì˜¤ëŠ˜ ê¸°ë¡í•˜ê¸°
        </button>
        
        ${lastRec?`
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-2">ğŸ“Œ ìµœê·¼ ê¸°ë¡</h3>
          <p class="text-sm text-gray-400 mb-1">${lastRec.date}</p>
          <p class="text-sm">ìˆ˜ë©´: ${lastRec.sleep}h | ìš´ë™: ${lastRec.exercise||'ì—†ìŒ'}</p>
          ${lastSymptoms.length>0?`<p class="text-sm mt-1">ì¦ìƒ: ${lastSymptoms.join(', ')}</p>`:''}
          <button onclick="editRecord('${lastRec.date}')" class="text-xs text-green-400 mt-2 hover:underline">ìˆ˜ì •í•˜ê¸°</button>
        </div>
        `:''}
        
        ${lastSymptoms.length>0?`
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ’Š ë§ì¶¤ ì¶”ì²œ ì˜ì–‘ì œ</h3>
          <div class="flex flex-wrap gap-2">
            ${recommendations.supplements.slice(0,4).map(s=>`
              <button onclick="openNaverShopping('${s}')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
                ${s} ğŸ”
              </button>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ¥— ì¶”ì²œ ìŒì‹</h3>
          <div class="flex flex-wrap gap-2">
            ${recommendations.foods.slice(0,4).map(f=>`
              <span class="bg-green-900/40 px-3 py-2 rounded-lg text-sm border border-green-700/50">${f}</span>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">âœ… ì¶”ì²œ ìŠµê´€</h3>
          <div class="space-y-2">
            ${recommendations.habits.slice(0,3).map(h=>`
              <div class="flex items-start gap-2 p-2 bg-gray-800/50 rounded">
                <span class="text-green-400">âœ“</span>
                <span class="text-sm">${h}</span>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸƒ ì¶”ì²œ ìš´ë™</h3>
          <div class="bg-blue-900/40 p-3 rounded-lg border border-blue-700/50">
            <p class="text-sm">${recommendations.exercise}</p>
          </div>
        </div>
        `:`
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-3">ğŸ’Š ì¸ê¸° ê±´ê°• ì œí’ˆ</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="openNaverShopping('ë¹„íƒ€ë¯¼D')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
              ë¹„íƒ€ë¯¼D ğŸ”
            </button>
            <button onclick="openNaverShopping('ì˜¤ë©”ê°€3')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
              ì˜¤ë©”ê°€3 ğŸ”
            </button>
            <button onclick="openNaverShopping('í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
              í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤ ğŸ”
            </button>
            <button onclick="openNaverShopping('ë§ˆê·¸ë„¤ìŠ˜')" class="bg-purple-900/40 px-3 py-2 rounded-lg text-sm border border-purple-700/50 hover:bg-purple-800/40">
              ë§ˆê·¸ë„¤ìŠ˜ ğŸ”
            </button>
          </div>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-2">ğŸ’¡ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
          <p class="text-sm text-gray-400">ì¦ìƒì„ ê¸°ë¡í•˜ë©´ ë” ì •í™•í•œ ë§ì¶¤ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        `}
      </div>
      ${navBar('home')}
    `;
  }
  
  else if(page==='record'){
    const lastRec=DB.records[DB.records.length-1];
    const selectedSymptoms=lastRec&&lastRec.symptoms?lastRec.symptoms:[];
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ì˜¤ëŠ˜ì˜ ê¸°ë¡</h2>
        
        <label class="block mb-2 font-bold">ğŸ’¤ ìˆ˜ë©´ ì‹œê°„ (í•„ìˆ˜)</label>
        <input type="number" id="sleep" placeholder="7" class="mb-4" step="0.5" min="0" max="24">
        
        <label class="block mb-2 font-bold">ğŸƒ ìš´ë™</label>
        <select id="exercise" class="mb-4">
          <option value="none">ì•ˆ í•¨</option>
          <option value="walk">ê±·ê¸°</option>
          <option value="run">ë‹¬ë¦¬ê¸°</option>
          <option value="gym">í—¬ìŠ¤</option>
          <option value="yoga">ìš”ê°€</option>
          <option value="swimming">ìˆ˜ì˜</option>
          <option value="cycling">ìì „ê±°</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸº ìŒì£¼</label>
        <select id="drinking" class="mb-4">
          <option value="none">ì•ˆ í•¨</option>
          <option value="week1">ì£¼ 1íšŒ</option>
          <option value="week2-3">ì£¼ 2~3íšŒ</option>
          <option value="week4+">ì£¼ 4íšŒ ì´ìƒ</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸš¬ í¡ì—°</label>
        <select id="smoking" class="mb-4">
          <option value="no">X (ì•ˆ í•¨)</option>
          <option value="yes">O (í•¨)</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸ¥ ë¶ˆí¸í•œ ì¦ìƒ ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</label>
        <div class="mb-4 p-4 bg-gray-800/50 rounded-lg" id="symptomSelector">
          ${SYMPTOMS.map(s=>`
            <span class="symptom-tag ${selectedSymptoms.includes(s)?'selected':''}" onclick="toggleSymptom('${s}')">${s}</span>
          `).join('')}
        </div>
        <div id="selectedSymptomsText" class="text-sm text-gray-400 mb-4"></div>
        
        <label class="block mb-2 font-bold">ğŸ’Š ì˜ì–‘ì œ ë³µìš© ì²´í¬</label>
        <div class="mb-4 space-y-2" id="supplementsSelector">
          ${DB.supplements.map(supp=>{
            const today=new Date().toISOString().split('T')[0];
            const checked=DB.dailySuppStatus[today]&&DB.dailySuppStatus[today][supp.id]?'checked':'';
            return `
              <div class="supp-item">
                <div class="supp-checkbox ${checked}" onclick="toggleSupplement(${supp.id})">
                  ${checked?'âœ“':''}
                </div>
                <div class="flex-1">
                  <p class="font-bold">${supp.name}</p>
                  <p class="text-xs text-gray-400">${supp.time} Â· ${supp.dose}</p>
                </div>
              </div>
            `;
          }).join('')}
        </div>
        <button onclick="render('manageSupplements')" class="text-xs text-gray-400 hover:text-green-400 mb-4">ì˜ì–‘ì œ ê´€ë¦¬ â†’</button>
        
        <label class="block mb-2 font-bold">ğŸ“ ë©”ëª¨</label>
        <textarea id="note" rows="3" placeholder="ì˜¤ëŠ˜ì˜ ë©”ëª¨" class="mb-6"></textarea>
        
        <button onclick="saveRecord()" class="mint-btn w-full py-4 text-lg">
          ğŸ’¾ ì €ì¥í•˜ê³  ì¶”ì²œë°›ê¸°
        </button>
      </div>
    `;
    updateSelectedSymptoms();
  }
  
  else if(page==='calendar'){
    const filtered=getFilteredDates();
    
    let html=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-4">ìº˜ë¦°ë”</h2>
        
        <input type="text" id="calendarSearch" placeholder="ğŸ” ì¦ìƒ ê²€ìƒ‰ (ì˜ˆ: í”¼ë¡œ, ë‘í†µ)" class="search-bar mb-3" oninput="filterRecordsBySearch()">
        
        <div class="mb-4 flex gap-2 flex-wrap">
          <button class="filter-btn ${DB.dateFilter==='1month'?'active':''}" onclick="setDateFilter('1month')">1ê°œì›”</button>
          <button class="filter-btn ${DB.dateFilter==='3month'?'active':''}" onclick="setDateFilter('3month')">3ê°œì›”</button>
          <button class="filter-btn ${DB.dateFilter==='lastmonth'?'active':''}" onclick="setDateFilter('lastmonth')">ì§€ë‚œë‹¬</button>
          <button class="filter-btn" onclick="showDatePicker()">ì§ì ‘ì…ë ¥</button>
        </div>
    `;
    
    const today=new Date();
    const month=today.getMonth();
    const year=today.getFullYear();
    const firstDay=new Date(year,month,1).getDay();
    const daysInMonth=new Date(year,month+1,0).getDate();
    
    html+='<div class="dark-card"><div class="text-center mb-3 font-bold">'+year+'ë…„ '+(month+1)+'ì›”</div><div class="calendar mb-4">';
    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>html+=`<div class="text-center text-xs text-gray-400">${d}</div>`);
    
    for(let i=0;i<firstDay;i++)html+='<div></div>';
    for(let d=1;d<=daysInMonth;d++){
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      const hasRecord=DB.records.some(r=>r.date===dateStr);
      const isToday=d===today.getDate();
      html+=`<div class="cal-day ${hasRecord?'recorded':''} ${isToday?'today':''}" onclick="showDayDetail('${dateStr}')">${d}</div>`;
    }
    html+='</div></div>';
    
    html+='<div class="dark-card"><h3 class="font-bold mb-4">ê¸°ë¡ ëª©ë¡ ('+filtered.length+'ê°œ)</h3>';
    if(filtered.length===0){
      html+='<p class="text-sm text-gray-400">ì„ íƒí•œ ê¸°ê°„ì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
    }else{
      filtered.slice().reverse().forEach(r=>{
        const symptoms=r.symptoms&&r.symptoms.length>0?r.symptoms.join(', '):'ì—†ìŒ';
        html+=`<div class="p-3 mb-2 bg-gray-800 rounded">
          <div class="flex justify-between items-start mb-1">
            <p class="text-sm text-gray-400">${r.date}</p>
            <div class="flex gap-2">
              <button onclick="editRecord('${r.date}')" class="text-xs text-green-400 hover:underline">ìˆ˜ì •</button>
              <button onclick="deleteRecord('${r.date}')" class="text-xs text-red-400 hover:underline">ì‚­ì œ</button>
            </div>
          </div>
          <p class="text-sm">ğŸ’¤ ${r.sleep}h | ğŸƒ ${r.exercise||'ì—†ìŒ'}</p>
          <p class="text-sm text-gray-400">ì¦ìƒ: ${symptoms}</p>
        </div>`;
      });
    }
    html+='</div></div>'+navBar('calendar');
    app.innerHTML=html;
  }
  
  else if(page==='analysis'){
    const filtered=getFilteredDates();
    
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ê±´ê°• ë¶„ì„</h2>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“ˆ ìˆ˜ë©´ ì¶”ì´</h3>
          <canvas id="sleepChart" height="200"></canvas>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ¥ ì¦ìƒë³„ ë°œìƒ ë¹ˆë„</h3>
          <canvas id="symptomChart" height="200"></canvas>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“Š í†µê³„</h3>
          <p class="text-sm mb-2">í‰ê·  ìˆ˜ë©´: ${avgSleep()}ì‹œê°„</p>
          <p class="text-sm mb-2">ìš´ë™ ì¼ìˆ˜: ${exerciseDays()}ì¼</p>
          <p class="text-sm">ê°€ì¥ ë§ì€ ì¦ìƒ: ${topSymptom()}</p>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ’Š ì¶”ì²œ ì˜ì–‘ì œ êµ¬ë§¤</h3>
          <p class="text-sm text-gray-400 mb-3">ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤</p>
          <div id="recommendedSupplements"></div>
        </div>
      </div>
      ${navBar('analysis')}
    `;
    
    setTimeout(()=>{
      const ctx=document.getElementById('sleepChart');
      if(ctx&&filtered.length>0){
        new Chart(ctx,{
          type:'line',
          data:{
            labels:filtered.slice(-14).map(r=>r.date.slice(5)),
            datasets:[{
              label:'ìˆ˜ë©´ì‹œê°„',
              data:filtered.slice(-14).map(r=>parseFloat(r.sleep)||0),
              borderColor:'#00d9c0',
              backgroundColor:'rgba(0,217,192,0.1)',
              tension:0.4,
              fill:true
            }]
          },
          options:{
            plugins:{legend:{labels:{color:'#fff'}}},
            scales:{
              y:{ticks:{color:'#fff'},grid:{color:'#333'}},
              x:{ticks:{color:'#fff'},grid:{color:'#333'}}
            }
          }
        });
      }
      
      // ì¦ìƒë³„ ì°¨íŠ¸
      const symptomCounts={};
      DB.records.forEach(r=>{
        if(r.symptoms&&r.symptoms.length>0){
          r.symptoms.forEach(s=>symptomCounts[s]=(symptomCounts[s]||0)+1);
        }
      });
      
      const ctx2=document.getElementById('symptomChart');
      if(ctx2&&Object.keys(symptomCounts).length>0){
        new Chart(ctx2,{
          type:'bar',
          data:{
            labels:Object.keys(symptomCounts),
            datasets:[{
              label:'ë°œìƒ íšŸìˆ˜',
              data:Object.values(symptomCounts),
              backgroundColor:'rgba(0,217,192,0.6)',
              borderColor:'#00d9c0',
              borderWidth:2
            }]
          },
          options:{
            plugins:{legend:{labels:{color:'#fff'}}},
            scales:{
              y:{ticks:{color:'#fff'},grid:{color:'#333'}},
              x:{ticks:{color:'#fff'},grid:{color:'#333'}}
            }
          }
        });
      }
      
      showAnalysisRecommendations();
    },100);
  }
  
  else if(page==='goals'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ëª©í‘œ ì„¤ì •</h2>
        
        <div class="dark-card">
          <h3 class="font-bold mb-4">ğŸ¯ ì£¼ê°„ ëª©í‘œ</h3>
          
          <label class="block mb-2 font-bold">ğŸ’¤ í‰ê·  ìˆ˜ë©´ ì‹œê°„ (ì‹œê°„)</label>
          <input type="number" id="goalSleep" value="${DB.goals.sleep}" class="mb-4" min="0" max="12" step="0.5">
          
          <label class="block mb-2 font-bold">ğŸƒ ì£¼ê°„ ìš´ë™ íšŸìˆ˜ (íšŒ)</label>
          <input type="number" id="goalExercise" value="${DB.goals.exercise}" class="mb-4" min="0" max="7">
          
          <label class="block mb-2 font-bold">ğŸ’§ ì¼ì¼ ë¬¼ ì„­ì·¨ (ì”)</label>
          <input type="number" id="goalWater" value="${DB.goals.water}" class="mb-6" min="0" max="20">
          
          <button onclick="saveGoals()" class="mint-btn w-full py-4">
            ğŸ’¾ ëª©í‘œ ì €ì¥
          </button>
        </div>
      </div>
      ${navBar('goals')}
    `;
  }
  
  else if(page==='manageSupplements'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('record')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ì˜ì–‘ì œ ê´€ë¦¬</h2>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ’Š ë‚´ ì˜ì–‘ì œ ë¦¬ìŠ¤íŠ¸</h3>
          <div class="space-y-3">
            ${DB.supplements.map(supp=>`
              <div class="bg-gray-800/50 p-3 rounded-lg">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="font-bold">${supp.name}</p>
                    <p class="text-xs text-gray-400">${supp.time} Â· ${supp.dose}</p>
                  </div>
                  <button onclick="deleteSupplementPrompt(${supp.id})" class="text-red-400 text-sm">ì‚­ì œ</button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-4">â• ì˜ì–‘ì œ ì¶”ê°€</h3>
          <input type="text" id="newSuppName" placeholder="ì˜ì–‘ì œ ì´ë¦„" class="mb-2">
          <select id="newSuppTime" class="mb-2">
            <option value="ì•„ì¹¨">ì•„ì¹¨</option>
            <option value="ì ì‹¬">ì ì‹¬</option>
            <option value="ì €ë…">ì €ë…</option>
            <option value="ì·¨ì¹¨ ì „">ì·¨ì¹¨ ì „</option>
          </select>
          <input type="text" id="newSuppDose" placeholder="ë³µìš©ëŸ‰ (ì˜ˆ: 1ì •)" class="mb-3">
          <button onclick="addSupplement()" class="mint-btn w-full">ì¶”ê°€í•˜ê¸°</button>
        </div>
        
        <div class="dark-card mt-4">
          <h3 class="font-bold mb-3">ğŸ“Š ë³µìš© í†µê³„ (ì´ë²ˆ ì£¼)</h3>
          ${generateSupplementStats()}
        </div>
      </div>
      ${navBar('record')}
    `;
  }
  
  else if(page==='manageTodos'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">í•  ì¼ ê´€ë¦¬</h2>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“‹ ë‚´ í•  ì¼ ë¦¬ìŠ¤íŠ¸</h3>
          <div class="space-y-3">
            ${DB.todos.map(todo=>`
              <div class="bg-gray-800/50 p-3 rounded-lg">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="font-bold">${todo.icon} ${todo.text}</p>
                  </div>
                  <button onclick="deleteTodoPrompt(${todo.id})" class="text-red-400 text-sm">ì‚­ì œ</button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-4">â• í•  ì¼ ì¶”ê°€</h3>
          <select id="newTodoIcon" class="mb-2">
            <option value="ğŸ“">ğŸ“ ì¼ë°˜</option>
            <option value="ğŸ’Š">ğŸ’Š ê±´ê°•</option>
            <option value="ğŸƒ">ğŸƒ ìš´ë™</option>
            <option value="ğŸ’§">ğŸ’§ ë¬¼</option>
            <option value="ğŸ¥—">ğŸ¥— ì‹ì‚¬</option>
            <option value="ğŸ˜´">ğŸ˜´ ìˆ˜ë©´</option>
            <option value="ğŸ“š">ğŸ“š ê³µë¶€</option>
            <option value="ğŸ’¼">ğŸ’¼ ì—…ë¬´</option>
          </select>
          <input type="text" id="newTodoText" placeholder="í•  ì¼ ë‚´ìš©" class="mb-3">
          <button onclick="addTodo()" class="mint-btn w-full">ì¶”ê°€í•˜ê¸°</button>
        </div>
        
        <div class="dark-card mt-4">
          <h3 class="font-bold mb-3">ğŸ“Š ì™„ë£Œìœ¨ (ì´ë²ˆ ì£¼)</h3>
          ${generateTodoStats()}
        </div>
      </div>
      ${navBar('home')}
    `;
  }
  
  else if(page==='profile'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">í”„ë¡œí•„</h2>
        
        <div class="dark-card">
          <label class="block mb-2 font-bold">ì´ë¦„</label>
          <input type="text" id="name" value="${DB.profile.name}" class="mb-4">
          
          <label class="block mb-2 font-bold">ë‚˜ì´</label>
          <input type="number" id="age" value="${DB.profile.age||''}" class="mb-4">
          
          <label class="block mb-2 font-bold">ì„±ë³„</label>
          <select id="gender" class="mb-4">
            <option value="" ${!DB.profile.gender?'selected':''}>ì„ íƒ</option>
            <option value="male" ${DB.profile.gender==='male'?'selected':''}>ë‚¨ì„±</option>
            <option value="female" ${DB.profile.gender==='female'?'selected':''}>ì—¬ì„±</option>
          </select>
          
          <label class="block mb-2 font-bold">í‚¤ (cm)</label>
          <input type="number" id="height" value="${DB.profile.height||''}" class="mb-4">
          
          <label class="block mb-2 font-bold">ëª¸ë¬´ê²Œ (kg)</label>
          <input type="number" id="weight" value="${DB.profile.weight||''}" class="mb-4">
          
          <button onclick="calcBMI()" class="w-full bg-gray-700 py-3 rounded-lg mb-4">BMI ê³„ì‚°</button>
          <div id="bmiResult" class="text-center p-4 bg-gray-800 rounded hidden"></div>
        </div>
        
        <button onclick="saveProfile()" class="mint-btn w-full py-4 mt-4">
          ğŸ’¾ ì €ì¥í•˜ê¸°
        </button>
        
        <div class="dark-card mt-4">
          <h3 class="font-bold mb-3">âš™ï¸ ë°ì´í„° ê´€ë¦¬</h3>
          <div class="space-y-2">
            <button onclick="exportData()" class="w-full bg-blue-600 py-3 rounded-lg text-sm">
              ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)
            </button>
            <button onclick="importData()" class="w-full bg-green-600 py-3 rounded-lg text-sm">
              ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µêµ¬)
            </button>
            <button onclick="resetOnboarding()" class="w-full bg-purple-600 py-3 rounded-lg text-sm">
              ğŸ¯ ì˜¨ë³´ë”© ë‹¤ì‹œë³´ê¸°
            </button>
            <button onclick="resetApp()" class="w-full bg-red-600 py-3 rounded-lg text-sm">
              ğŸ”„ ì•± ì´ˆê¸°í™” (í…ŒìŠ¤íŠ¸ìš©)
            </button>
          </div>
        </div>
      </div>
      ${navBar('profile')}
    `;
  }
  
  else if(page==='community'){
    if(!DB.communityTab)DB.communityTab='popular';
    
    if(!DB.communityPosts){
      DB.communityPosts={
        popular:[
          {author:"ê±´ê°•ì§€í‚´ì´",text:"ë§¤ì¼ ì•„ì¹¨ ë¬¼ í•œ ì»µ ë§ˆì‹œê¸° ì‹œì‘í–ˆëŠ”ë° í”¼ë¶€ê°€ ì¢‹ì•„ì¡Œì–´ìš”!",likes:124,comments:18,time:"2ì‹œê°„ ì „"},
          {author:"ìš”ê°€ëŸ¬ë²„",text:"ìš”ê°€ 30ì¼ ì±Œë¦°ì§€ ì™„ë£Œ! í—ˆë¦¬ í†µì¦ì´ ë§ì´ ì¤„ì—ˆìŠµë‹ˆë‹¤ ğŸ‘",likes:89,comments:12,time:"5ì‹œê°„ ì „"},
          {author:"ì˜ì–‘ì‚¬í˜„ì£¼",text:"ë¹„íƒ€ë¯¼DëŠ” ì•„ì¹¨ì—, ë§ˆê·¸ë„¤ìŠ˜ì€ ì €ë…ì— ë¨¹ëŠ”ê²Œ í¡ìˆ˜ìœ¨ì´ ì¢‹ì•„ìš”",likes:156,comments:23,time:"1ì¼ ì „"},
          {author:"í—¬ìŠ¤ì™•",text:"ê¾¸ì¤€í•œ ìš´ë™ì´ ë‹µì…ë‹ˆë‹¤. ì‘ì€ ê²ƒë¶€í„° ì‹œì‘í•˜ì„¸ìš”!",likes:67,comments:9,time:"2ì¼ ì „"}
        ],
        challenge:[
          {author:"ì±Œë¦°ì§€ë§ˆìŠ¤í„°",text:"ğŸ”¥ 30ì¼ ë¬¼ 2L ë§ˆì‹œê¸° ì±Œë¦°ì§€ ì°¸ì—¬ì ëª¨ì§‘!",likes:45,comments:28,participants:156,time:"1ì‹œê°„ ì „"},
          {author:"ì•„ì¹¨ìš´ë™ëŸ¬",text:"ğŸƒ ë§¤ì¼ ì•„ì¹¨ 20ë¶„ ê±·ê¸° ì±Œë¦°ì§€ 2ì£¼ì°¨ ë‹¬ì„±!",likes:32,comments:15,participants:89,time:"3ì‹œê°„ ì „"},
          {author:"ìˆ˜ë©´ì™•",text:"ğŸ˜´ ë°¤ 11ì‹œ ì „ ì·¨ì¹¨ ì±Œë¦°ì§€ - í•¨ê»˜ í•´ìš”!",likes:58,comments:21,participants:203,time:"6ì‹œê°„ ì „"}
        ],
        following:[
          {author:"ê±´ê°•ì§€í‚´ì´",text:"ì˜¤ëŠ˜ë„ 8ì‹œê°„ ìˆ˜ë©´ ì„±ê³µ! ì»¨ë””ì…˜ì´ ì •ë§ ì¢‹ì•„ìš” â˜€ï¸",likes:12,comments:3,time:"30ë¶„ ì „"},
          {author:"ìš”ê°€ëŸ¬ë²„",text:"ìƒˆë¡œìš´ ìš”ê°€ ë™ì‘ ë°°ì› ì–´ìš”. ë‹¤ë“¤ í•œë²ˆ í•´ë³´ì„¸ìš”!",likes:8,comments:2,time:"1ì‹œê°„ ì „"}
        ]
      };
    }
    
    const tabs=['popular','challenge','following'];
    const tabNames={popular:'ì¸ê¸°',challenge:'ì±Œë¦°ì§€',following:'íŒ”ë¡œì‰'};
    
    app.innerHTML=`
      <div class="pb-24">
        <div class="p-6 pb-0 flex items-center justify-between">
          <h2 class="text-2xl font-bold">ì»¤ë®¤ë‹ˆí‹°</h2>
          <button onclick="showWriteModal()" class="mint-btn py-2 px-4 text-sm">
            âœï¸ ê¸€ì“°ê¸°
          </button>
        </div>
        
        <div class="px-6 mt-4">
          <input type="text" id="communitySearch" placeholder="ğŸ” ê²€ìƒ‰ (ì œëª©, ë‚´ìš©, ì‘ì„±ì)" class="search-bar" oninput="filterCommunityPosts()">
        </div>
        
        <div class="flex border-b border-gray-800 px-6 mt-4">
          ${tabs.map(t=>`
            <button class="tab-btn ${DB.communityTab===t?'text-green-400 border-green-400':'text-gray-500'}" 
                    style="padding:12px 20px;border-bottom:2px solid ${DB.communityTab===t?'#00d9c0':'transparent'}"
                    onclick="switchCommunityTab('${t}')">
              ${tabNames[t]}
            </button>
          `).join('')}
        </div>
        
        <div class="p-6 space-y-3" id="communityPostsContainer">
          ${renderCommunityPosts()}
        </div>
      </div>
      ${navBar('community')}
    `;
  }
}

function navBar(active){
  return `<div class="nav"><div class="flex">
    <button onclick="render('home')" class="${active==='home'?'active':''}">
      <div class="text-2xl mb-1">ğŸ </div>
      <div class="text-xs">í™ˆ</div>
    </button>
    <button onclick="render('record')" class="${active==='record'?'active':''}">
      <div class="text-2xl mb-1">â•</div>
      <div class="text-xs">ê¸°ë¡</div>
    </button>
    <button onclick="render('calendar')" class="${active==='calendar'?'active':''}">
      <div class="text-2xl mb-1">ğŸ“…</div>
      <div class="text-xs">ìº˜ë¦°ë”</div>
    </button>
    <button onclick="render('analysis')" class="${active==='analysis'?'active':''}">
      <div class="text-2xl mb-1">ğŸ“Š</div>
      <div class="text-xs">ë¶„ì„</div>
    </button>
    <button onclick="render('community')" class="${active==='community'?'active':''}">
      <div class="text-2xl mb-1">ğŸ‘¥</div>
      <div class="text-xs">ì»¤ë®¤ë‹ˆí‹°</div>
    </button>
  </div></div>`;
}

let selectedSymptoms=[];

function toggleSymptom(symptom){
  const idx=selectedSymptoms.indexOf(symptom);
  if(idx>-1){
    selectedSymptoms.splice(idx,1);
  }else{
    selectedSymptoms.push(symptom);
  }
  updateSelectedSymptoms();
}

function updateSelectedSymptoms(){
  const tags=document.querySelectorAll('.symptom-tag');
  tags.forEach(tag=>{
    const symptom=tag.textContent;
    if(selectedSymptoms.includes(symptom)){
      tag.classList.add('selected');
    }else{
      tag.classList.remove('selected');
    }
  });
  
  const text=document.getElementById('selectedSymptomsText');
  if(text){
    if(selectedSymptoms.length>0){
      text.textContent='ì„ íƒë¨: '+selectedSymptoms.join(', ');
      text.classList.remove('text-gray-400');
      text.classList.add('text-green-400');
    }else{
      text.textContent='ì¦ìƒì„ ì„ íƒí•˜ì„¸ìš”';
      text.classList.add('text-gray-400');
      text.classList.remove('text-green-400');
    }
  }
}

function saveRecord(){
  const sleep=document.getElementById('sleep').value;
  
  if(!sleep||sleep<0||sleep>24){
    showToast('ìˆ˜ë©´ ì‹œê°„ì„ 0-24ì‹œê°„ ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”','error');
    return;
  }
  
  // ì˜ì–‘ì œ ë³µìš© ì²´í¬ ìˆ˜ì§‘
  const today=new Date().toISOString().split('T')[0];
  const takenSupplements=[];
  DB.supplements.forEach(supp=>{
    if(DB.dailySuppStatus[today]&&DB.dailySuppStatus[today][supp.id]){
      takenSupplements.push(supp.name);
    }
  });
  
  const rec={
    date:today,
    sleep:sleep,
    exercise:document.getElementById('exercise').value,
    drinking:document.getElementById('drinking').value,
    smoking:document.getElementById('smoking').value,
    symptoms:[...selectedSymptoms],
    supplements:takenSupplements.join(', '),
    note:document.getElementById('note').value
  };
  
  // ë¡œë”© í™”ë©´ í‘œì‹œ
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML=`
    <div class="modal-content text-center">
      <div class="w-20 h-20 mx-auto mb-4 relative">
        <div style="width:80px;height:80px;border:8px solid #3a3a3a;border-top:8px solid #00d9c0;border-radius:50%;animation:spin 1s linear infinite"></div>
      </div>
      <h3 class="text-xl font-bold mb-2">ë¶„ì„ ì¤‘...</h3>
      <p class="text-sm text-gray-400">ê±´ê°• ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
    </div>
    <style>
      @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    </style>
  `;
  document.body.appendChild(modal);
  
  // 2.5ì´ˆ í›„ ì €ì¥ ë° í˜ì´ì§€ ì´ë™
  setTimeout(()=>{
    DB.records.push(rec);
    save();
    selectedSymptoms=[];
    modal.remove();
    showToast('ê¸°ë¡ ì™„ë£Œ! ë§ì¶¤ ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš” ğŸ‰','success');
    render('home');
  },2500);
}

function editRecord(date){
  const rec=DB.records.find(r=>r.date===date);
  if(!rec)return;
  
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML=`
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold">ê¸°ë¡ ìˆ˜ì •</h3>
        <button onclick="closeModal()" class="text-3xl text-gray-400">Ã—</button>
      </div>
      
      <label class="block mb-2 font-bold">ğŸ’¤ ìˆ˜ë©´ ì‹œê°„</label>
      <input type="number" id="editSleep" value="${rec.sleep}" class="mb-3" step="0.5">
      
      <label class="block mb-2 font-bold">ğŸƒ ìš´ë™</label>
      <select id="editExercise" class="mb-3">
        <option value="none" ${rec.exercise==='none'?'selected':''}>ì•ˆ í•¨</option>
        <option value="walk" ${rec.exercise==='walk'?'selected':''}>ê±·ê¸°</option>
        <option value="run" ${rec.exercise==='run'?'selected':''}>ë‹¬ë¦¬ê¸°</option>
        <option value="gym" ${rec.exercise==='gym'?'selected':''}>í—¬ìŠ¤</option>
        <option value="yoga" ${rec.exercise==='yoga'?'selected':''}>ìš”ê°€</option>
      </select>
      
      <label class="block mb-2 font-bold">ğŸ“ ë©”ëª¨</label>
      <textarea id="editNote" rows="3" class="mb-4">${rec.note||''}</textarea>
      
      <div class="flex gap-2">
        <button onclick="closeModal()" class="flex-1 bg-gray-700 py-3 rounded-xl">ì·¨ì†Œ</button>
        <button onclick="updateRecord('${date}')" class="flex-1 mint-btn py-3 rounded-xl">ì €ì¥</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

function updateRecord(date){
  const rec=DB.records.find(r=>r.date===date);
  if(!rec)return;
  
  rec.sleep=document.getElementById('editSleep').value;
  rec.exercise=document.getElementById('editExercise').value;
  rec.note=document.getElementById('editNote').value;
  
  save();
  closeModal();
  alert('âœ… ìˆ˜ì • ì™„ë£Œ!');
  render('calendar');
}

function deleteRecord(date){
  if(!confirm('ì •ë§ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  
  DB.records=DB.records.filter(r=>r.date!==date);
  save();
  alert('âœ… ì‚­ì œ ì™„ë£Œ!');
  render('calendar');
}

function closeModal(){
  const modal=document.querySelector('.modal');
  if(modal)modal.remove();
}

function saveProfile(){
  DB.profile.name=document.getElementById('name').value;
  DB.profile.age=document.getElementById('age').value;
  DB.profile.gender=document.getElementById('gender').value;
  DB.profile.height=document.getElementById('height').value;
  DB.profile.weight=document.getElementById('weight').value;
  save();
  alert('âœ… í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!');
}

function calcBMI(){
  const h=parseFloat(DB.profile.height)/100;
  const w=parseFloat(DB.profile.weight);
  if(h&&w){
    const bmi=(w/(h*h)).toFixed(1);
    let cat='';
    if(bmi<18.5)cat='ì €ì²´ì¤‘';
    else if(bmi<23)cat='ì •ìƒ';
    else if(bmi<25)cat='ê³¼ì²´ì¤‘';
    else cat='ë¹„ë§Œ';
    document.getElementById('bmiResult').innerHTML=`<p class="text-3xl font-bold text-green-400">${bmi}</p><p class="text-sm text-gray-400">${cat}</p>`;
    document.getElementById('bmiResult').classList.remove('hidden');
  }
}

function setDateFilter(filter){
  DB.dateFilter=filter;
  save();
  render('calendar');
}

function showDatePicker(){
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML=`
    <div class="modal-content">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">ğŸ“… ê¸°ê°„ ì„ íƒ</h3>
        <button onclick="closeModal()" class="text-3xl text-gray-400 hover:text-white">Ã—</button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block mb-2 font-bold text-sm">ì‹œì‘ ë‚ ì§œ</label>
          <input type="date" id="customStartDate" class="w-full" value="${new Date().toISOString().split('T')[0]}">
        </div>
        
        <div>
          <label class="block mb-2 font-bold text-sm">ì¢…ë£Œ ë‚ ì§œ</label>
          <input type="date" id="customEndDate" class="w-full" value="${new Date().toISOString().split('T')[0]}">
        </div>
        
        <div class="flex gap-2">
          <button onclick="applyCustomDateRange()" class="mint-btn flex-1 py-3">
            âœ… ì ìš©í•˜ê¸°
          </button>
          <button onclick="closeModal()" class="bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
            ì·¨ì†Œ
          </button>
        </div>
      </div>
      
      <div class="mt-6 p-4 bg-blue-900/20 border border-blue-700/30 rounded-lg">
        <p class="text-sm text-blue-300">ğŸ’¡ íŒ: íŠ¹ì • ê¸°ê°„ì˜ ê¸°ë¡ì„ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”!</p>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

function applyCustomDateRange(){
  const start=document.getElementById('customStartDate').value;
  const end=document.getElementById('customEndDate').value;
  
  if(!start||!end){
    showToast('ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”','error');
    return;
  }
  
  if(start>end){
    showToast('ì‹œì‘ ë‚ ì§œê°€ ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤','error');
    return;
  }
  
  DB.dateFilter='custom';
  DB.customStart=start;
  DB.customEnd=end;
  save();
  closeModal();
  showToast('ê¸°ê°„ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“…','success');
  render('calendar');
}

function showDayDetail(date){
  const rec=DB.records.find(r=>r.date===date);
  if(rec){
    const symptoms=rec.symptoms&&rec.symptoms.length>0?rec.symptoms.join(', '):'ì—†ìŒ';
    const modal=document.createElement('div');
    modal.className='modal';
    modal.innerHTML=`
      <div class="modal-content">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold">ğŸ“… ${date}</h3>
          <button onclick="closeModal()" class="text-3xl text-gray-400 hover:text-white">Ã—</button>
        </div>
        
        <div class="space-y-4">
          <div class="dark-card">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <p class="text-xs text-gray-400 mb-1">ğŸ’¤ ìˆ˜ë©´</p>
                <p class="text-lg font-bold text-blue-400">${rec.sleep}ì‹œê°„</p>
              </div>
              <div>
                <p class="text-xs text-gray-400 mb-1">ğŸƒ ìš´ë™</p>
                <p class="text-lg font-bold text-green-400">${rec.exercise||'ì—†ìŒ'}</p>
              </div>
              <div>
                <p class="text-xs text-gray-400 mb-1">ğŸº ìŒì£¼</p>
                <p class="text-lg font-bold text-yellow-400">${rec.drinking||'ì—†ìŒ'}</p>
              </div>
              <div>
                <p class="text-xs text-gray-400 mb-1">ğŸš¬ í¡ì—°</p>
                <p class="text-lg font-bold text-red-400">${rec.smoking||'ì—†ìŒ'}</p>
              </div>
            </div>
          </div>
          
          <div class="dark-card">
            <p class="text-xs text-gray-400 mb-2">ğŸ¥ ì¦ìƒ</p>
            <p class="text-sm">${symptoms}</p>
          </div>
          
          ${rec.supplements?`
          <div class="dark-card">
            <p class="text-xs text-gray-400 mb-2">ğŸ’Š ì˜ì–‘ì œ</p>
            <p class="text-sm">${rec.supplements}</p>
          </div>
          `:''}
          
          ${rec.note?`
          <div class="dark-card">
            <p class="text-xs text-gray-400 mb-2">ğŸ“ ë©”ëª¨</p>
            <p class="text-sm">${rec.note}</p>
          </div>
          `:''}
          
          <div class="flex gap-2">
            <button onclick="editRecord('${date}');closeModal();" class="mint-btn flex-1 py-3">
              âœï¸ ìˆ˜ì •í•˜ê¸°
            </button>
            <button onclick="closeModal()" class="bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-600">
              ë‹«ê¸°
            </button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
  }else{
    showToast('ì´ ë‚ ì§œì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤','warning');
  }
}

function avgSleep(){
  if(DB.records.length===0)return 0;
  const sum=DB.records.reduce((a,r)=>a+parseFloat(r.sleep||0),0);
  return(sum/DB.records.length).toFixed(1);
}

function exerciseDays(){
  return DB.records.filter(r=>r.exercise&&r.exercise!=='none').length;
}

function topSymptom(){
  const counts={};
  DB.records.forEach(r=>{
    if(r.symptoms&&r.symptoms.length>0){
      r.symptoms.forEach(s=>counts[s]=(counts[s]||0)+1);
    }
  });
  const top=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
  return top?top[0]:'ì—†ìŒ';
}

function showAnalysisRecommendations(){
  const topSym=topSymptom();
  if(topSym==='ì—†ìŒ'){
    document.getElementById('recommendedSupplements').innerHTML='<p class="text-sm text-gray-400">ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>';
    return;
  }
  
  const rule=RULES.find(r=>r.c===topSym);
  if(rule){
    const html=rule.s.slice(0,4).map(s=>`
      <button onclick="openNaverShopping('${s}')" class="w-full mb-2 p-3 bg-purple-900/40 rounded-lg border border-purple-700/50 hover:bg-purple-800/40 text-left flex justify-between items-center">
        <span>${s}</span>
        <span class="text-sm">ê²€ìƒ‰ â†’</span>
      </button>
    `).join('');
    document.getElementById('recommendedSupplements').innerHTML=html;
  }
}

function openNaverShopping(keyword){
  window.open(`https://search.shopping.naver.com/search/all?query=${encodeURIComponent(keyword)}`,'_blank');
}

function showComments(tab,postIndex){
  const commentId=`comments-${tab}-${postIndex}`;
  const commentDiv=document.getElementById(commentId);
  
  if(!commentDiv)return;
  
  // í† ê¸€
  if(commentDiv.style.display==='none'){
    // ëŒ“ê¸€ ë°ì´í„° ì´ˆê¸°í™”
    if(!DB.communityComments)DB.communityComments={};
    const key=`${tab}-${postIndex}`;
    if(!DB.communityComments[key]){
      DB.communityComments[key]=[
        {author:'í—¬ìŠ¤ë§¤ë‹ˆì•„',text:'ì¢‹ì€ ì •ë³´ ê°ì‚¬í•©ë‹ˆë‹¤!',time:'1ì‹œê°„ ì „'},
        {author:'ê±´ê°•ì™•ì´ˆë³´',text:'ì €ë„ í•´ë´ì•¼ê² ì–´ìš” ğŸ‘',time:'2ì‹œê°„ ì „'}
      ];
    }
    
    const comments=DB.communityComments[key];
    
    commentDiv.innerHTML=`
      <div class="space-y-2 mb-3">
        ${comments.map((c,i)=>`
          <div class="p-2 bg-gray-800/50 rounded">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs font-bold">${c.author}</span>
              <span class="text-xs text-gray-500">${c.time}</span>
            </div>
            <p class="text-xs">${c.text}</p>
          </div>
        `).join('')}
      </div>
      <div class="flex gap-2">
        <input type="text" id="newComment-${key}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." class="flex-1 p-2 text-sm rounded-lg bg-gray-800 border-0">
        <button onclick="addComment('${key}')" class="mint-btn px-4 py-2 text-xs">ë“±ë¡</button>
      </div>
    `;
    commentDiv.style.display='block';
  }else{
    commentDiv.style.display='none';
  }
}

function addComment(key){
  const input=document.getElementById(`newComment-${key}`);
  if(!input||!input.value)return;
  
  if(!DB.communityComments[key])DB.communityComments[key]=[];
  
  DB.communityComments[key].push({
    author:DB.profile.name,
    text:input.value,
    time:'ë°©ê¸ˆ ì „'
  });
  
  // ëŒ“ê¸€ ìˆ˜ ì¦ê°€
  const [tab,postIndex]=key.split('-');
  if(DB.communityPosts[tab][postIndex]){
    DB.communityPosts[tab][postIndex].comments++;
  }
  
  save();
  render('community');
}

function saveGoals(){
  DB.goals.sleep=parseFloat(document.getElementById('goalSleep').value);
  DB.goals.exercise=parseInt(document.getElementById('goalExercise').value);
  DB.goals.water=parseInt(document.getElementById('goalWater').value);
  save();
  alert('âœ… ëª©í‘œ ì €ì¥ ì™„ë£Œ!');
  render('home');
}

function switchCommunityTab(tab){
  DB.communityTab=tab;
  render('community');
}

function renderCommunityPosts(){
  if(!DB.communityPosts)return '';
  
  const posts=DB.communityPosts[DB.communityTab]||[];
  
  // ëŒ“ê¸€ ì´ˆê¸°í™”
  if(!DB.communityComments)DB.communityComments={};
  
  if(DB.communityTab==='challenge'){
    return posts.map((p,i)=>`
      <div class="dark-card">
        <div class="flex items-start gap-3 mb-2">
          <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center font-bold">
            ${p.author[0]}
          </div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-bold text-sm">${p.author}</span>
              <span class="text-xs text-gray-500">${p.time}</span>
            </div>
            <p class="text-sm mb-2">${p.text}</p>
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs bg-purple-900/40 px-2 py-1 rounded border border-purple-700/50">
                ğŸ‘¥ ${p.participants}ëª… ì°¸ì—¬ì¤‘
              </span>
            </div>
            <div class="flex gap-4 text-sm text-gray-400">
              <button onclick="likeCommunityPost('${DB.communityTab}',${i})" class="hover:text-red-400">
                â¤ï¸ ${p.likes}
              </button>
              <button onclick="showComments('${DB.communityTab}',${i})" class="hover:text-blue-400">ğŸ’¬ ${p.comments}</button>
              <button onclick="joinChallenge()" class="ml-auto text-green-400 hover:text-green-300">
                ì°¸ì—¬í•˜ê¸° â†’
              </button>
            </div>
          </div>
        </div>
        <div id="comments-${DB.communityTab}-${i}" style="display:none" class="mt-3 pl-12 border-l-2 border-gray-700"></div>
      </div>
    `).join('');
  }
  
  return posts.map((p,i)=>`
    <div class="dark-card">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-green-500 rounded-full flex items-center justify-center font-bold">
          ${p.author[0]}
        </div>
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-1">
            <span class="font-bold text-sm">${p.author}</span>
            <span class="text-xs text-gray-500">${p.time}</span>
          </div>
          <p class="text-sm mb-2">${p.text}</p>
          <div class="flex gap-4 text-sm text-gray-400">
            <button onclick="likeCommunityPost('${DB.communityTab}',${i})" class="hover:text-red-400">
              â¤ï¸ ${p.likes}
            </button>
            <button onclick="showComments('${DB.communityTab}',${i})" class="hover:text-blue-400">ğŸ’¬ ${p.comments}</button>
            ${DB.communityTab==='following'?'<button class="ml-auto text-gray-500 text-xs">íŒ”ë¡œì‰</button>':''}
          </div>
        </div>
      </div>
      <div id="comments-${DB.communityTab}-${i}" style="display:none" class="mt-3 pl-12 border-l-2 border-gray-700"></div>
    </div>
  `).join('');
}

function likeCommunityPost(tab,index){
  if(!DB.communityPosts[tab][index])return;
  DB.communityPosts[tab][index].likes++;
  save();
  render('community');
}

function showWriteModal(){
  const modal=document.createElement('div');
  modal.id='writeModal';
  modal.className='modal';
  modal.innerHTML=`
    <div class="modal-content">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">ê¸€ì“°ê¸°</h3>
        <button onclick="closeWriteModal()" class="text-3xl text-gray-400">Ã—</button>
      </div>
      <textarea id="communityPostText" rows="5" placeholder="ë¬´ì—‡ì„ ê³µìœ í•˜ì‹œê² ì–´ìš”?" 
                class="w-full p-4 rounded-xl bg-gray-800 border-0 text-white resize-none mb-4"></textarea>
      <div class="flex gap-2">
        <button onclick="closeWriteModal()" class="flex-1 bg-gray-700 py-3 rounded-xl">ì·¨ì†Œ</button>
        <button onclick="submitCommunityPost()" class="flex-1 mint-btn py-3 rounded-xl font-bold">ê²Œì‹œ</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

function closeWriteModal(){
  const modal=document.getElementById('writeModal');
  if(modal)modal.remove();
}

function submitCommunityPost(){
  const text=document.getElementById('communityPostText').value;
  if(text){
    const post={
      author:DB.profile.name,
      text:text,
      likes:0,
      comments:0,
      time:'ë°©ê¸ˆ ì „'
    };
    
    if(!DB.communityPosts.popular)DB.communityPosts.popular=[];
    DB.communityPosts.popular.unshift(post);
    save();
    closeWriteModal();
    DB.communityTab='popular';
    render('community');
  }
}

function joinChallenge(){
  alert('ğŸ‰ ì±Œë¦°ì§€ ì°¸ì—¬ ì™„ë£Œ! í™”ì´íŒ…!');
}

function exportData(){
  const dataStr=JSON.stringify(DB,null,2);
  const blob=new Blob([dataStr],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`mybodydiary-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  alert('âœ… ë°ì´í„°ë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤!');
}

function importData(){
  const input=document.createElement('input');
  input.type='file';
  input.accept='.json';
  input.onchange=e=>{
    const file=e.target.files[0];
    if(!file)return;
    
    const reader=new FileReader();
    reader.onload=event=>{
      try{
        const imported=JSON.parse(event.target.result);
        DB={...DB,...imported};
        save();
        alert('âœ… ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
        render('home');
      }catch(err){
        alert('âŒ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

function resetApp(){
  if(!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  if(!confirm('ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'))return;
  
  localStorage.clear();
  sessionStorage.clear();
  alert('âœ… ì•±ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
  location.reload();
}

// í•  ì¼ í† ê¸€
function toggleTodo(todoId){
  const today=new Date().toISOString().split('T')[0];
  if(!DB.dailyTodoStatus[today]){
    DB.dailyTodoStatus[today]=DB.todos.map(t=>({id:t.id,completed:false}));
  }
  const todoStatus=DB.dailyTodoStatus[today].find(t=>t.id===todoId);
  if(todoStatus){
    todoStatus.completed=!todoStatus.completed;
    save();
    render('home');
    if(todoStatus.completed){
      showToast('ì™„ë£Œ! ğŸ‰','success');
    }
  }
}

// ì˜ì–‘ì œ í† ê¸€
function toggleSupplement(suppId){
  const today=new Date().toISOString().split('T')[0];
  if(!DB.dailySuppStatus[today]){
    DB.dailySuppStatus[today]={};
  }
  DB.dailySuppStatus[today][suppId]=!DB.dailySuppStatus[today][suppId];
  save();
  render('record');
  if(DB.dailySuppStatus[today][suppId]){
    showToast('ë³µìš© ì²´í¬! ğŸ’Š','success');
  }
}

// ì˜ì–‘ì œ ì¶”ê°€
function addSupplement(){
  const name=document.getElementById('newSuppName').value.trim();
  const time=document.getElementById('newSuppTime').value;
  const dose=document.getElementById('newSuppDose').value.trim();
  
  if(!name||!dose){
    showToast('ì˜ì–‘ì œ ì´ë¦„ê³¼ ë³µìš©ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”','error');
    return;
  }
  
  const newId=DB.supplements.length>0?Math.max(...DB.supplements.map(s=>s.id))+1:1;
  DB.supplements.push({id:newId,name,time,dose});
  save();
  showToast('ì˜ì–‘ì œ ì¶”ê°€ ì™„ë£Œ! ğŸ’Š','success');
  render('manageSupplements');
}

// ì˜ì–‘ì œ ì‚­ì œ
function deleteSupplementPrompt(suppId){
  if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    DB.supplements=DB.supplements.filter(s=>s.id!==suppId);
    save();
    showToast('ì‚­ì œ ì™„ë£Œ!','success');
    render('manageSupplements');
  }
}

// ì˜ì–‘ì œ í†µê³„ ìƒì„±
function generateSupplementStats(){
  const weekAgo=new Date();
  weekAgo.setDate(weekAgo.getDate()-7);
  
  let html='';
  DB.supplements.forEach(supp=>{
    let takenCount=0;
    let totalDays=0;
    
    for(let i=0;i<7;i++){
      const date=new Date();
      date.setDate(date.getDate()-i);
      const dateStr=date.toISOString().split('T')[0];
      totalDays++;
      if(DB.dailySuppStatus[dateStr]&&DB.dailySuppStatus[dateStr][supp.id]){
        takenCount++;
      }
    }
    
    const rate=totalDays>0?Math.round((takenCount/totalDays)*100):0;
    html+=`
      <div class="mb-3">
        <div class="flex justify-between text-sm mb-1">
          <span>${supp.name}</span>
          <span class="text-green-400">${rate}%</span>
        </div>
        <div class="goal-progress">
          <div class="goal-fill" style="width:${rate}%"></div>
        </div>
        <p class="text-xs text-gray-400 mt-1">${takenCount}/7ì¼ ë³µìš©</p>
      </div>
    `;
  });
  
  return html||'<p class="text-sm text-gray-400">ì•„ì§ ë³µìš© ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
}

// í•  ì¼ ì¶”ê°€
function addTodo(){
  const icon=document.getElementById('newTodoIcon').value;
  const text=document.getElementById('newTodoText').value.trim();
  
  if(!text){
    showToast('í•  ì¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”','error');
    return;
  }
  
  const newId=DB.todos.length>0?Math.max(...DB.todos.map(t=>t.id))+1:1;
  DB.todos.push({id:newId,text,icon,completed:false});
  save();
  showToast('í•  ì¼ ì¶”ê°€ ì™„ë£Œ! âœ…','success');
  render('manageTodos');
}

// í•  ì¼ ì‚­ì œ
function deleteTodoPrompt(todoId){
  if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    DB.todos=DB.todos.filter(t=>t.id!==todoId);
    save();
    showToast('ì‚­ì œ ì™„ë£Œ!','success');
    render('manageTodos');
  }
}

// í•  ì¼ í†µê³„ ìƒì„±
function generateTodoStats(){
  const weekAgo=new Date();
  weekAgo.setDate(weekAgo.getDate()-7);
  
  let totalTodos=0;
  let completedTodos=0;
  
  for(let i=0;i<7;i++){
    const date=new Date();
    date.setDate(date.getDate()-i);
    const dateStr=date.toISOString().split('T')[0];
    
    if(DB.dailyTodoStatus[dateStr]){
      totalTodos+=DB.dailyTodoStatus[dateStr].length;
      completedTodos+=DB.dailyTodoStatus[dateStr].filter(t=>t.completed).length;
    }
  }
  
  const rate=totalTodos>0?Math.round((completedTodos/totalTodos)*100):0;
  
  return `
    <div class="mb-3">
      <div class="flex justify-between text-sm mb-1">
        <span>ì „ì²´ ì™„ë£Œìœ¨</span>
        <span class="text-green-400">${rate}%</span>
      </div>
      <div class="goal-progress">
        <div class="goal-fill" style="width:${rate}%"></div>
      </div>
      <p class="text-xs text-gray-400 mt-1">${completedTodos}/${totalTodos}ê°œ ì™„ë£Œ</p>
    </div>
  `;
}

// ê²€ìƒ‰ í•„í„° (ìº˜ë¦°ë”)
function filterRecordsBySearch(){
  const searchTerm=document.getElementById('calendarSearch').value.toLowerCase().trim();
  
  const filtered=getFilteredDates().filter(record=>{
    if(!searchTerm)return true;
    
    const symptoms=(record.symptoms||[]).join(' ').toLowerCase();
    const note=(record.note||'').toLowerCase();
    const exercise=(record.exercise||'').toLowerCase();
    
    return symptoms.includes(searchTerm)||note.includes(searchTerm)||exercise.includes(searchTerm);
  });
  
  // ê²°ê³¼ ì—…ë°ì´íŠ¸
  const resultsDiv=document.querySelector('.dark-card:last-child');
  if(resultsDiv){
    let html=`<h3 class="font-bold mb-4">ê²€ìƒ‰ ê²°ê³¼ (${filtered.length}ê°œ)</h3>`;
    if(filtered.length===0){
      html+='<p class="text-sm text-gray-400">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
    }else{
      filtered.slice().reverse().forEach(r=>{
        const symptoms=r.symptoms&&r.symptoms.length>0?r.symptoms.join(', '):'ì—†ìŒ';
        html+=`<div class="p-3 mb-2 bg-gray-800 rounded">
          <div class="flex justify-between items-start mb-1">
            <p class="text-sm text-gray-400">${r.date}</p>
            <div class="flex gap-2">
              <button onclick="editRecord('${r.date}')" class="text-xs text-green-400 hover:underline">ìˆ˜ì •</button>
              <button onclick="deleteRecord('${r.date}')" class="text-xs text-red-400 hover:underline">ì‚­ì œ</button>
            </div>
          </div>
          <p class="text-sm">ğŸ’¤ ${r.sleep}h | ğŸƒ ${r.exercise||'ì—†ìŒ'}</p>
          <p class="text-sm text-gray-400">ì¦ìƒ: ${symptoms}</p>
        </div>`;
      });
    }
    resultsDiv.innerHTML=html;
  }
}

// ì»¤ë®¤ë‹ˆí‹° ê²€ìƒ‰ í•„í„°
function filterCommunityPosts(){
  const searchTerm=document.getElementById('communitySearch').value.toLowerCase().trim();
  const posts=DB.communityPosts[DB.communityTab]||[];
  
  const filtered=posts.filter(post=>{
    if(!searchTerm)return true;
    
    const text=(post.text||'').toLowerCase();
    const author=(post.author||'').toLowerCase();
    
    return text.includes(searchTerm)||author.includes(searchTerm);
  });
  
  const container=document.getElementById('communityPostsContainer');
  if(container){
    if(filtered.length===0){
      container.innerHTML=`
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ”</div>
          <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      `;
    }else{
      let html='';
      filtered.forEach((post,idx)=>{
        const isChallenge=DB.communityTab==='challenge';
        html+=`
          <div class="dark-card">
            <div class="flex justify-between items-start mb-2">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-400 rounded-full flex items-center justify-center text-sm font-bold">
                  ${post.author[0]}
                </div>
                <div>
                  <p class="font-bold text-sm">${post.author}</p>
                  <p class="text-xs text-gray-400">${post.time}</p>
                </div>
              </div>
              <button onclick="toggleFollowUser('${post.author}')" class="text-xs px-2 py-1 rounded ${DB.communityTab==='following'?'bg-gray-700 text-gray-400':'bg-green-900/40 text-green-400 hover:bg-green-800/40'}">
                ${DB.communityTab==='following'?'íŒ”ë¡œì‰':'íŒ”ë¡œìš°'}
              </button>
            </div>
            
            <p class="text-sm mb-3">${post.text}</p>
            
            ${isChallenge?`
              <div class="flex items-center gap-2 mb-3 p-2 bg-purple-900/30 rounded">
                <span class="text-xs">ğŸ‘¥ ${post.participants}ëª… ì°¸ì—¬ ì¤‘</span>
                <button onclick="joinChallenge(${idx})" class="text-xs px-3 py-1 bg-purple-700 rounded hover:bg-purple-600 ml-auto">ì°¸ì—¬í•˜ê¸°</button>
              </div>
            `:''}
            
            <div class="flex gap-4 text-sm text-gray-400">
              <button onclick="togglePostLike(${idx})" class="hover:text-red-400">
                â¤ï¸ ${post.likes}
              </button>
              <button onclick="togglePostComments(${idx})" class="hover:text-blue-400">
                ğŸ’¬ ${post.comments}
              </button>
              <button class="hover:text-gray-300">ğŸ”— ê³µìœ </button>
            </div>
          </div>
        `;
      });
      container.innerHTML=html;
    }
  }
}

function resetOnboarding(){
  localStorage.removeItem('onboardingDone');
  sessionStorage.removeItem('splashShown');
  showToast('ì˜¨ë³´ë”©ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤!','success');
  if(confirm('ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    location.reload();
  }
}

// Toast ì•Œë¦¼ ì‹œìŠ¤í…œ
function showToast(message,type='success'){
  const toast=document.createElement('div');
  toast.className=`toast ${type}`;
  
  const icon={
    success:'âœ…',
    error:'âŒ',
    warning:'âš ï¸',
    info:'â„¹ï¸'
  }[type]||'âœ…';
  
  toast.innerHTML=`
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:24px">${icon}</span>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(toast);
  
  setTimeout(()=>{
    toast.style.animation='slideOut 0.3s';
    setTimeout(()=>toast.remove(),300);
  },3000);
}

// ì…ë ¥ ê²€ì¦ í—¬í¼
function validateInput(id,min,max,label){
  const input=document.getElementById(id);
  if(!input)return true;
  
  const value=parseFloat(input.value);
  
  if(!input.value){
    input.classList.add('error');
    showToast(`${label}ì„(ë¥¼) ì…ë ¥í•˜ì„¸ìš”`,'error');
    return false;
  }
  
  if(value<min||value>max){
    input.classList.add('error');
    showToast(`${label}ì€(ëŠ”) ${min}-${max} ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”`,'error');
    return false;
  }
  
  input.classList.remove('error');
  return true;
}

// ì…ë ¥ í•„ë“œ ì—ëŸ¬ ì œê±°
function clearError(id){
  const input=document.getElementById(id);
  if(input)input.classList.remove('error');
}

</script>
</body>
</html>
