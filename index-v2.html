<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ëª¸ì¼ê¸° v2.0 ì™„ì „íŒ</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:#1a1a1a;color:#fff}
.app{max-width:480px;margin:0 auto;min-height:100vh}
.page{display:none}
.page.active{display:block}
.mint-btn{background:#00d9c0;color:#000;font-weight:700;padding:12px 24px;border-radius:12px;border:none;cursor:pointer}
.dark-card{background:#2a2a2a;border-radius:16px;padding:20px;margin:10px 0}
.nav{position:fixed;bottom:0;left:0;right:0;background:#1f1f1f;border-top:1px solid#333;max-width:480px;margin:0 auto}
.nav button{flex:1;padding:12px;background:none;border:none;color:#888;cursor:pointer}
.nav button.active{color:#00d9c0}
input,select,textarea{background:#2a2a2a;border:1px solid#3a3a3a;color:#fff;padding:12px;border-radius:8px;width:100%;margin:8px 0}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;background:#2a2a2a}
.cal-day.recorded{background:#00d9c0;color:#000}
.cal-day.today{border:2px solid#00d9c0}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ë°ì´í„° êµ¬ì¡°
let DB={
  records:[],
  profile:{name:'ì‚¬ìš©ì',age:30,gender:'',height:170,weight:65},
  posts:[],
  challenges:{water:0,caffeine:0,walk:0}
};

// RULE ë°ì´í„° (í™•ì¥)
const RULES=[
  {c:"ë³€ë¹„",s:["í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤","í”„ë¦¬ë°”ì´ì˜¤í‹±ìŠ¤"],f:["ê·€ë¦¬","ìš”ê±°íŠ¸","ë¸”ë£¨ë² ë¦¬"],e:"ìŠ¤íŠ¸ë ˆì¹­ 15ë¶„"},
  {c:"í”¼ë¡œ",s:["ë¹„íƒ€ë¯¼Bë³µí•©ì²´","ì½”ì—”ìì„Q10"],f:["ì‹œê¸ˆì¹˜","ê²¬ê³¼ë¥˜","ì—°ì–´"],e:"ê±·ê¸° 20ë¶„"},
  {c:"ë¶ˆë©´ì¦",s:["ë©œë¼í† ë‹Œ","ë§ˆê·¸ë„¤ìŠ˜"],f:["ë°”ë‚˜ë‚˜","ìš°ìœ ","í˜¸ë‘"],e:"ìš”ê°€ 30ë¶„"},
  {c:"ë‘í†µ",s:["ë§ˆê·¸ë„¤ìŠ˜","ë¹„íƒ€ë¯¼B2"],f:["ë¬¼","ì‹œê¸ˆì¹˜"],e:"ìŠ¤íŠ¸ë ˆì¹­ 10ë¶„"},
  {c:"ìŠ¤íŠ¸ë ˆìŠ¤",s:["ë§ˆê·¸ë„¤ìŠ˜","í…Œì•„ë‹Œ"],f:["ë°”ë‚˜ë‚˜","ì•„ëª¬ë“œ"],e:"ìš”ê°€ 20ë¶„"}
];

const SYMPTOMS=["ë³€ë¹„","í”¼ë¡œ","ë¶ˆë©´ì¦","ë‘í†µ","ìŠ¤íŠ¸ë ˆìŠ¤","ì†Œí™”ë¶ˆëŸ‰","ê·¼ìœ¡í†µ","ê´€ì ˆí†µ"];

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
function load(){const d=localStorage.getItem('mybodydata');if(d)DB=JSON.parse(d)}
function save(){localStorage.setItem('mybodydata',JSON.stringify(DB))}

load();

// í˜ì´ì§€ ë Œë”ë§
function render(page){
  const app=document.getElementById('app');
  
  if(page==='home'){
    const total=DB.records.length;
    const lastRec=DB.records[DB.records.length-1];
    app.innerHTML=`
      <div class="p-6 pb-24">
        <h1 class="text-3xl font-bold mb-2">ë‚´ëª¸ì¼ê¸° v2.0</h1>
        <p class="text-gray-400 mb-6">ì•ˆë…•í•˜ì„¸ìš”, ${DB.profile.name}ë‹˜!</p>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="dark-card">
            <p class="text-sm text-gray-400">ì´ ê¸°ë¡</p>
            <p class="text-3xl font-bold text-green-400">${total}ê°œ</p>
          </div>
          <div class="dark-card">
            <p class="text-sm text-gray-400">ì—°ì† ê¸°ë¡</p>
            <p class="text-3xl font-bold text-green-400">${Math.min(total,7)}ì¼</p>
          </div>
        </div>
        
        <button onclick="render('record')" class="mint-btn w-full text-xl py-6 mb-4">
          ğŸ“ ì˜¤ëŠ˜ ê¸°ë¡í•˜ê¸°
        </button>
        
        <div class="dark-card">
          <h3 class="font-bold mb-2">ìµœê·¼ ê¸°ë¡</h3>
          <p class="text-sm text-gray-400">${lastRec?`ìˆ˜ë©´: ${lastRec.sleep}h, ì¦ìƒ: ${lastRec.symptom||'ì—†ìŒ'}`:'ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤'}</p>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-2">ì˜¤ëŠ˜ì˜ ì±Œë¦°ì§€</h3>
          <div class="space-y-2">
            <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
              <span>ğŸ’§ ë¬¼ 1.5L</span>
              <button onclick="completeChallenge('water')" class="text-xs bg-green-500 px-3 py-1 rounded">${DB.challenges.water?'âœ“':'ì™„ë£Œ'}</button>
            </div>
            <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
              <span>â˜• ì¹´í˜ì¸ 2ì”â†“</span>
              <button onclick="completeChallenge('caffeine')" class="text-xs bg-green-500 px-3 py-1 rounded">${DB.challenges.caffeine?'âœ“':'ì™„ë£Œ'}</button>
            </div>
            <div class="flex justify-between items-center p-2 bg-gray-800 rounded">
              <span>ğŸš¶ 20ë¶„ ê±·ê¸°</span>
              <button onclick="completeChallenge('walk')" class="text-xs bg-green-500 px-3 py-1 rounded">${DB.challenges.walk?'âœ“':'ì™„ë£Œ'}</button>
            </div>
          </div>
        </div>
      </div>
      ${navBar('home')}
    `;
  }
  
  else if(page==='record'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ì˜¤ëŠ˜ì˜ ê¸°ë¡</h2>
        
        <label class="block mb-2 font-bold">ğŸ’¤ ìˆ˜ë©´ ì‹œê°„</label>
        <input type="number" id="sleep" placeholder="7" class="mb-4">
        
        <label class="block mb-2 font-bold">ğŸƒ ìš´ë™</label>
        <select id="exercise" class="mb-4">
          <option value="none">ì•ˆ í•¨</option>
          <option value="walk">ê±·ê¸°</option>
          <option value="run">ë‹¬ë¦¬ê¸°</option>
          <option value="gym">í—¬ìŠ¤</option>
          <option value="yoga">ìš”ê°€</option>
        </select>
        
        <label class="block mb-2 font-bold">ğŸ¥ ì¦ìƒ ì„ íƒ</label>
        <select id="symptom" class="mb-4">
          <option value="">ì—†ìŒ</option>
          ${SYMPTOMS.map(s=>`<option value="${s}">${s}</option>`).join('')}
        </select>
        
        <label class="block mb-2 font-bold">ğŸ’Š ì˜ì–‘ì œ</label>
        <input type="text" id="supplements" placeholder="ë¹„íƒ€ë¯¼D, ì˜¤ë©”ê°€3" class="mb-4">
        
        <label class="block mb-2 font-bold">ğŸ“ ë©”ëª¨</label>
        <textarea id="note" rows="3" placeholder="ì˜¤ëŠ˜ì˜ ë©”ëª¨" class="mb-6"></textarea>
        
        <button onclick="saveRecord()" class="mint-btn w-full py-4 text-lg">
          ğŸ’¾ ì €ì¥í•˜ê³  ì¶”ì²œë°›ê¸°
        </button>
      </div>
    `;
  }
  
  else if(page==='calendar'){
    let html='<div class="p-6 pb-24"><button onclick="render(\'home\')" class="mb-4 text-xl">â† ë’¤ë¡œ</button><h2 class="text-2xl font-bold mb-6">ìº˜ë¦°ë”</h2>';
    
    const today=new Date();
    const month=today.getMonth();
    const year=today.getFullYear();
    const firstDay=new Date(year,month,1).getDay();
    const daysInMonth=new Date(year,month+1,0).getDate();
    
    html+='<div class="dark-card"><div class="calendar mb-4">';
    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>html+=`<div class="text-center text-xs text-gray-400">${d}</div>`);
    
    for(let i=0;i<firstDay;i++)html+='<div></div>';
    for(let d=1;d<=daysInMonth;d++){
      const dateStr=`${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      const hasRecord=DB.records.some(r=>r.date===dateStr);
      const isToday=d===today.getDate();
      html+=`<div class="cal-day ${hasRecord?'recorded':''} ${isToday?'today':''}">${d}</div>`;
    }
    html+='</div></div>';
    
    html+='<div class="dark-card"><h3 class="font-bold mb-4">ì´ë²ˆ ë‹¬ ê¸°ë¡</h3>';
    DB.records.slice(-10).reverse().forEach(r=>{
      html+=`<div class="p-3 mb-2 bg-gray-800 rounded">
        <p class="text-sm text-gray-400">${r.date}</p>
        <p>ìˆ˜ë©´: ${r.sleep}h | ì¦ìƒ: ${r.symptom||'ì—†ìŒ'}</p>
      </div>`;
    });
    html+='</div></div>'+navBar('calendar');
    app.innerHTML=html;
  }
  
  else if(page==='analysis'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">ê±´ê°• ë¶„ì„</h2>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“ˆ ìˆ˜ë©´ ì¶”ì´</h3>
          <canvas id="sleepChart" height="200"></canvas>
        </div>
        
        <div class="dark-card mb-4">
          <h3 class="font-bold mb-4">ğŸ“Š í†µê³„</h3>
          <p class="text-sm mb-2">í‰ê·  ìˆ˜ë©´: ${avgSleep()}ì‹œê°„</p>
          <p class="text-sm mb-2">ìš´ë™ ì¼ìˆ˜: ${exerciseDays()}ì¼</p>
          <p class="text-sm">ê°€ì¥ ë§ì€ ì¦ìƒ: ${topSymptom()}</p>
        </div>
        
        <div class="dark-card">
          <h3 class="font-bold mb-4">âœ¨ í˜„ì¬ ì¶”ì²œ</h3>
          <div id="recommendations"></div>
        </div>
        
        <button onclick="shareReport()" class="mint-btn w-full py-4 mt-4">
          ğŸ”— ê²°ê³¼ ê³µìœ í•˜ê¸°
        </button>
      </div>
      ${navBar('analysis')}
    `;
    setTimeout(()=>{
      const ctx=document.getElementById('sleepChart');
      if(ctx)new Chart(ctx,{
        type:'line',
        data:{
          labels:DB.records.slice(-7).map(r=>r.date.slice(5)),
          datasets:[{
            label:'ìˆ˜ë©´ì‹œê°„',
            data:DB.records.slice(-7).map(r=>parseFloat(r.sleep)||0),
            borderColor:'#00d9c0',
            tension:0.4
          }]
        },
        options:{plugins:{legend:{labels:{color:'#fff'}}},scales:{y:{ticks:{color:'#fff'}},x:{ticks:{color:'#fff'}}}}
      });
      showRecommendations();
    },100);
  }
  
  else if(page==='profile'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <button onclick="render('home')" class="mb-4 text-xl">â† ë’¤ë¡œ</button>
        <h2 class="text-2xl font-bold mb-6">í”„ë¡œí•„</h2>
        
        <div class="dark-card">
          <label class="block mb-2">ì´ë¦„</label>
          <input type="text" id="name" value="${DB.profile.name}" class="mb-4">
          
          <label class="block mb-2">ë‚˜ì´</label>
          <input type="number" id="age" value="${DB.profile.age||''}" class="mb-4">
          
          <label class="block mb-2">ì„±ë³„</label>
          <select id="gender" class="mb-4">
            <option value="" ${!DB.profile.gender?'selected':''}>ì„ íƒ</option>
            <option value="male" ${DB.profile.gender==='male'?'selected':''}>ë‚¨ì„±</option>
            <option value="female" ${DB.profile.gender==='female'?'selected':''}>ì—¬ì„±</option>
          </select>
          
          <label class="block mb-2">í‚¤ (cm)</label>
          <input type="number" id="height" value="${DB.profile.height||''}" class="mb-4">
          
          <label class="block mb-2">ëª¸ë¬´ê²Œ (kg)</label>
          <input type="number" id="weight" value="${DB.profile.weight||''}" class="mb-4">
          
          <button onclick="calcBMI()" class="w-full bg-gray-700 py-3 rounded-lg mb-4">BMI ê³„ì‚°</button>
          <div id="bmiResult" class="text-center p-4 bg-gray-800 rounded hidden"></div>
        </div>
        
        <div class="dark-card">
          <button onclick="requestNotif()" class="w-full bg-yellow-500 text-black py-3 rounded-lg font-bold">
            ğŸ”” ì•Œë¦¼ ì„¤ì •
          </button>
        </div>
        
        <button onclick="saveProfile()" class="mint-btn w-full py-4 mt-4">
          ğŸ’¾ ì €ì¥í•˜ê¸°
        </button>
      </div>
      ${navBar('profile')}
    `;
  }
  
  else if(page==='community'){
    app.innerHTML=`
      <div class="p-6 pb-24">
        <h2 class="text-2xl font-bold mb-6">ì»¤ë®¤ë‹ˆí‹°</h2>
        
        <div class="dark-card mb-4">
          <textarea id="newPost" rows="3" placeholder="ê±´ê°• ì •ë³´ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!" class="mb-2"></textarea>
          <button onclick="addPost()" class="mint-btn w-full py-3">ê²Œì‹œí•˜ê¸°</button>
        </div>
        
        <div id="postList">
          ${DB.posts.map((p,i)=>`
            <div class="dark-card">
              <p class="mb-2">${p.text}</p>
              <div class="flex gap-4 text-sm text-gray-400">
                <button onclick="likePost(${i})" class="hover:text-red-400">â¤ï¸ ${p.likes||0}</button>
                <span>ğŸ’¬ ${p.comments||0}</span>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
      ${navBar('community')}
    `;
  }
}

function navBar(active){
  return `<div class="nav"><div class="flex">
    <button onclick="render('home')" class="${active==='home'?'active':''}">ğŸ <br><span class="text-xs">í™ˆ</span></button>
    <button onclick="render('record')" class="${active==='record'?'active':''}">â•<br><span class="text-xs">ê¸°ë¡</span></button>
    <button onclick="render('calendar')" class="${active==='calendar'?'active':''}">ğŸ“…<br><span class="text-xs">ìº˜ë¦°ë”</span></button>
    <button onclick="render('analysis')" class="${active==='analysis'?'active':''}">ğŸ“Š<br><span class="text-xs">ë¶„ì„</span></button>
    <button onclick="render('profile')" class="${active==='profile'?'active':''}">ğŸ‘¤<br><span class="text-xs">í”„ë¡œí•„</span></button>
  </div></div>`;
}

function saveRecord(){
  const rec={
    date:new Date().toISOString().split('T')[0],
    sleep:document.getElementById('sleep').value,
    exercise:document.getElementById('exercise').value,
    symptom:document.getElementById('symptom').value,
    supplements:document.getElementById('supplements').value,
    note:document.getElementById('note').value
  };
  DB.records.push(rec);
  save();
  alert('âœ… ê¸°ë¡ ì™„ë£Œ! ì¶”ì²œì„ í™•ì¸í•˜ì„¸ìš”.');
  render('home');
}

function saveProfile(){
  DB.profile.name=document.getElementById('name').value;
  DB.profile.age=document.getElementById('age').value;
  DB.profile.gender=document.getElementById('gender').value;
  DB.profile.height=document.getElementById('height').value;
  DB.profile.weight=document.getElementById('weight').value;
  save();
  alert('âœ… í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!');
}

function calcBMI(){
  const h=parseFloat(DB.profile.height)/100;
  const w=parseFloat(DB.profile.weight);
  if(h&&w){
    const bmi=(w/(h*h)).toFixed(1);
    let cat='';
    if(bmi<18.5)cat='ì €ì²´ì¤‘';
    else if(bmi<23)cat='ì •ìƒ';
    else if(bmi<25)cat='ê³¼ì²´ì¤‘';
    else cat='ë¹„ë§Œ';
    document.getElementById('bmiResult').innerHTML=`<p class="text-3xl font-bold text-green-400">${bmi}</p><p class="text-sm text-gray-400">${cat}</p>`;
    document.getElementById('bmiResult').classList.remove('hidden');
  }
}

function completeChallenge(type){
  DB.challenges[type]=1;
  save();
  render('home');
}

function avgSleep(){
  if(DB.records.length===0)return 0;
  const sum=DB.records.reduce((a,r)=>a+parseFloat(r.sleep||0),0);
  return(sum/DB.records.length).toFixed(1);
}

function exerciseDays(){
  return DB.records.filter(r=>r.exercise&&r.exercise!=='none').length;
}

function topSymptom(){
  const counts={};
  DB.records.forEach(r=>{if(r.symptom)counts[r.symptom]=(counts[r.symptom]||0)+1});
  const top=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
  return top?top[0]:'ì—†ìŒ';
}

function showRecommendations(){
  const lastRec=DB.records[DB.records.length-1];
  if(!lastRec||!lastRec.symptom){
    document.getElementById('recommendations').innerHTML='<p class="text-gray-400">ì¦ìƒì„ ê¸°ë¡í•˜ë©´ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>';
    return;
  }
  const rule=RULES.find(r=>r.c===lastRec.symptom);
  if(rule){
    document.getElementById('recommendations').innerHTML=`
      <p class="mb-2"><strong>ğŸ’Š ì˜ì–‘ì œ:</strong> ${rule.s.join(', ')}</p>
      <p class="mb-2"><strong>ğŸ¥— ìŒì‹:</strong> ${rule.f.join(', ')}</p>
      <p><strong>ğŸƒ ìš´ë™:</strong> ${rule.e}</p>
    `;
  }
}

function addPost(){
  const text=document.getElementById('newPost').value;
  if(text){
    DB.posts.unshift({text,likes:0,comments:0,date:new Date().toLocaleDateString()});
    save();
    render('community');
  }
}

function likePost(i){
  DB.posts[i].likes=(DB.posts[i].likes||0)+1;
  save();
  render('community');
}

function shareReport(){
  if(navigator.share){
    navigator.share({title:'ë‚´ëª¸ì¼ê¸°',text:`ìµœê·¼ 7ì¼ í‰ê·  ìˆ˜ë©´: ${avgSleep()}ì‹œê°„`});
  }else{
    alert('ê³µìœ  ë§í¬: '+window.location.href);
  }
}

function requestNotif(){
  if('Notification' in window){
    Notification.requestPermission().then(p=>{
      alert(p==='granted'?'âœ… ì•Œë¦¼ì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤!':'âŒ ì•Œë¦¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤');
    });
  }else{
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
  }
}

// ì´ˆê¸° ë Œë”ë§
render('home');
</script>
</body>
</html>
